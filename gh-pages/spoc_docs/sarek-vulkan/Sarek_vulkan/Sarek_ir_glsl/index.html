<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Sarek_ir_glsl (sarek-vulkan.Sarek_vulkan.Sarek_ir_glsl)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">sarek-vulkan</a> &#x00BB; <a href="../index.html">Sarek_vulkan</a> &#x00BB; Sarek_ir_glsl</nav><header class="odoc-preamble"><h1>Module <code><span>Sarek_vulkan.Sarek_ir_glsl</span></code></h1></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#type-mapping">Type Mapping</a></li><li><a href="#thread-intrinsics">Thread Intrinsics</a></li><li><a href="#expression-generation">Expression Generation</a></li><li><a href="#l-value-generation">L-value Generation</a></li><li><a href="#statement-generation">Statement Generation</a></li><li><a href="#helper-function-generation">Helper Function Generation</a></li><li><a href="#kernel-generation">Kernel Generation</a></li></ul></nav></div><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-current_variants"><a href="#val-current_variants" class="anchor"></a><code><span><span class="keyword">val</span> current_variants : 
  <span><span><span>(string * <span><span>(string * <span><a href="../../../spoc/Sarek_ir_types/index.html#type-elttype">Sarek_ir_types.elttype</a> list</span>)</span> list</span>)</span> list</span> <span class="xref-unresolved">Stdlib</span>.ref</span></span></code></div><div class="spec-doc"><p>Current kernel's variant definitions (set during generate)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-helper_vec_param_indices"><a href="#val-helper_vec_param_indices" class="anchor"></a><code><span><span class="keyword">val</span> helper_vec_param_indices : <span><span>(string, <span>int list</span>)</span> <span class="xref-unresolved">Stdlib</span>.Hashtbl.t</span></span></code></div><div class="spec-doc"><p>Helper function vector parameter indices - maps function name to set of parameter indices that are vectors. In GLSL, vectors cannot be passed as function parameters, so these must be filtered out at call sites.</p></div></div><h2 id="type-mapping"><a href="#type-mapping" class="anchor"></a>Type Mapping</h2><div class="odoc-spec"><div class="spec value anchored" id="val-mangle_name"><a href="#val-mangle_name" class="anchor"></a><code><span><span class="keyword">val</span> mangle_name : <span>string <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Mangle OCaml type name to valid GLSL identifier</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-glsl_reserved_keywords"><a href="#val-glsl_reserved_keywords" class="anchor"></a><code><span><span class="keyword">val</span> glsl_reserved_keywords : <span>string list</span></span></code></div><div class="spec-doc"><p>GLSL reserved keywords that cannot be used as identifiers</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-escape_glsl_name"><a href="#val-escape_glsl_name" class="anchor"></a><code><span><span class="keyword">val</span> escape_glsl_name : <span>string <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Escape reserved GLSL keywords by adding 'v' suffix (avoids double underscore with _len)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-glsl_type_of_elttype"><a href="#val-glsl_type_of_elttype" class="anchor"></a><code><span><span class="keyword">val</span> glsl_type_of_elttype : <span><a href="../../../spoc/Sarek_ir_types/index.html#type-elttype">Sarek_ir_types.elttype</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Map Sarek IR element type to GLSL type string</p></div></div><h2 id="thread-intrinsics"><a href="#thread-intrinsics" class="anchor"></a>Thread Intrinsics</h2><div class="odoc-spec"><div class="spec value anchored" id="val-glsl_thread_intrinsic"><a href="#val-glsl_thread_intrinsic" class="anchor"></a><code><span><span class="keyword">val</span> glsl_thread_intrinsic : <span>string <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><h2 id="expression-generation"><a href="#expression-generation" class="anchor"></a>Expression Generation</h2><div class="odoc-spec"><div class="spec value anchored" id="val-gen_expr"><a href="#val-gen_expr" class="anchor"></a><code><span><span class="keyword">val</span> gen_expr : <span><span class="xref-unresolved">Stdlib</span>.Buffer.t <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../spoc/Sarek_ir_types/index.html#type-expr">Sarek_ir_types.expr</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gen_binop"><a href="#val-gen_binop" class="anchor"></a><code><span><span class="keyword">val</span> gen_binop : <span><a href="../../../spoc/Sarek_ir_types/index.html#type-binop">Sarek_ir_types.binop</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gen_unop"><a href="#val-gen_unop" class="anchor"></a><code><span><span class="keyword">val</span> gen_unop : <span><a href="../../../spoc/Sarek_ir_types/index.html#type-unop">Sarek_ir_types.unop</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gen_intrinsic"><a href="#val-gen_intrinsic" class="anchor"></a><code><span><span class="keyword">val</span> gen_intrinsic : 
  <span><span class="xref-unresolved">Stdlib</span>.Buffer.t <span class="arrow">&#45;&gt;</span></span>
  <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../spoc/Sarek_ir_types/index.html#type-expr">Sarek_ir_types.expr</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><h2 id="l-value-generation"><a href="#l-value-generation" class="anchor"></a>L-value Generation</h2><div class="odoc-spec"><div class="spec value anchored" id="val-gen_lvalue"><a href="#val-gen_lvalue" class="anchor"></a><code><span><span class="keyword">val</span> gen_lvalue : <span><span class="xref-unresolved">Stdlib</span>.Buffer.t <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../spoc/Sarek_ir_types/index.html#type-lvalue">Sarek_ir_types.lvalue</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><h2 id="statement-generation"><a href="#statement-generation" class="anchor"></a>Statement Generation</h2><div class="odoc-spec"><div class="spec value anchored" id="val-indent_nested"><a href="#val-indent_nested" class="anchor"></a><code><span><span class="keyword">val</span> indent_nested : <span>string <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Nested indentation level</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gen_match_pattern"><a href="#val-gen_match_pattern" class="anchor"></a><code><span><span class="keyword">val</span> gen_match_pattern : 
  <span><span class="xref-unresolved">Stdlib</span>.Buffer.t <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>string <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../../../spoc/Sarek_ir_types/index.html#type-elttype">Sarek_ir_types.elttype</a> list</span> option</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Generate match case pattern with variable bindings</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gen_var_decl"><a href="#val-gen_var_decl" class="anchor"></a><code><span><span class="keyword">val</span> gen_var_decl : 
  <span><span class="xref-unresolved">Stdlib</span>.Buffer.t <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../spoc/Sarek_ir_types/index.html#type-elttype">Sarek_ir_types.elttype</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../spoc/Sarek_ir_types/index.html#type-expr">Sarek_ir_types.expr</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Generate variable declaration with optional initialization</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gen_array_decl"><a href="#val-gen_array_decl" class="anchor"></a><code><span><span class="keyword">val</span> gen_array_decl : 
  <span><span class="xref-unresolved">Stdlib</span>.Buffer.t <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../spoc/Sarek_ir_types/index.html#type-elttype">Sarek_ir_types.elttype</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../spoc/Sarek_ir_types/index.html#type-expr">Sarek_ir_types.expr</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Generate array declaration</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gen_stmt"><a href="#val-gen_stmt" class="anchor"></a><code><span><span class="keyword">val</span> gen_stmt : <span><span class="xref-unresolved">Stdlib</span>.Buffer.t <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../spoc/Sarek_ir_types/index.html#type-stmt">Sarek_ir_types.stmt</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><h2 id="helper-function-generation"><a href="#helper-function-generation" class="anchor"></a>Helper Function Generation</h2><div class="odoc-spec"><div class="spec value anchored" id="val-gen_helper_func"><a href="#val-gen_helper_func" class="anchor"></a><code><span><span class="keyword">val</span> gen_helper_func : 
  <span><span class="label">pc_names</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Stdlib</span>.Buffer.t <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../spoc/Sarek_ir_types/index.html#type-helper_func">Sarek_ir_types.helper_func</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Generate helper function with #undef/#define guards to avoid macro collisions. Push constant macros (e.g., #define max_iter pc.max_iter) would otherwise expand function parameters with the same name, causing syntax errors.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">pc_names</span> <p>Set of push constant names that have macros defined</p></li></ul></div></div><h2 id="kernel-generation"><a href="#kernel-generation" class="anchor"></a>Kernel Generation</h2><div class="odoc-spec"><div class="spec value anchored" id="val-count_vec_params"><a href="#val-count_vec_params" class="anchor"></a><code><span><span class="keyword">val</span> count_vec_params : <span><span><a href="../../../spoc/Sarek_ir_types/index.html#type-decl">Sarek_ir_types.decl</a> list</span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>Count vector parameters for binding assignment</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-glsl_header"><a href="#val-glsl_header" class="anchor"></a><code><span><span class="keyword">val</span> glsl_header : 
  <span><span class="label">kernel_name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?block</span>:<span>(int * int * int)</span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  string</span></code></div><div class="spec-doc"><p>Generate GLSL compute shader header.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">block</span> <p>Optional workgroup dimensions (x, y, z). Defaults to 256x1x1.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gen_buffer_binding"><a href="#val-gen_buffer_binding" class="anchor"></a><code><span><span class="keyword">val</span> gen_buffer_binding : 
  <span><span class="xref-unresolved">Stdlib</span>.Buffer.t <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../spoc/Sarek_ir_types/index.html#type-var">Sarek_ir_types.var</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../spoc/Sarek_ir_types/index.html#type-elttype">Sarek_ir_types.elttype</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Generate buffer binding for a vector parameter</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gen_push_constants"><a href="#val-gen_push_constants" class="anchor"></a><code><span><span class="keyword">val</span> gen_push_constants : <span><span class="xref-unresolved">Stdlib</span>.Buffer.t <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../../../spoc/Sarek_ir_types/index.html#type-decl">Sarek_ir_types.decl</a> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-collect_shared_decls"><a href="#val-collect_shared_decls" class="anchor"></a><code><span><span class="keyword">val</span> collect_shared_decls : 
  <span><a href="../../../spoc/Sarek_ir_types/index.html#type-stmt">Sarek_ir_types.stmt</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(string * <a href="../../../spoc/Sarek_ir_types/index.html#type-elttype">Sarek_ir_types.elttype</a> * <a href="../../../spoc/Sarek_ir_types/index.html#type-expr">Sarek_ir_types.expr</a>)</span> list</span></span></code></div><div class="spec-doc"><p>Collect shared array declarations from a statement tree. Returns list of (name, elem_type, size_expr)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gen_shared_decls"><a href="#val-gen_shared_decls" class="anchor"></a><code><span><span class="keyword">val</span> gen_shared_decls : 
  <span><span class="xref-unresolved">Stdlib</span>.Buffer.t <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(string * <a href="../../../spoc/Sarek_ir_types/index.html#type-elttype">Sarek_ir_types.elttype</a> * <a href="../../../spoc/Sarek_ir_types/index.html#type-expr">Sarek_ir_types.expr</a>)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Generate shared declarations at module scope</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-generate"><a href="#val-generate" class="anchor"></a><code><span><span class="keyword">val</span> generate : <span><span class="optlabel">?block</span>:<span>(int * int * int)</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../spoc/Sarek_ir_types/index.html#type-kernel">Sarek_ir_types.kernel</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Generate complete GLSL source for a kernel.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">block</span> <p>Optional workgroup dimensions (x, y, z). Defaults to 256x1x1.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gen_record_def"><a href="#val-gen_record_def" class="anchor"></a><code><span><span class="keyword">val</span> gen_record_def : 
  <span><span class="xref-unresolved">Stdlib</span>.Buffer.t <span class="arrow">&#45;&gt;</span></span>
  <span><span>(string * <span><span>(string * <a href="../../../spoc/Sarek_ir_types/index.html#type-elttype">Sarek_ir_types.elttype</a>)</span> list</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Generate GLSL record type definition - simple struct without tag</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gen_variant_def"><a href="#val-gen_variant_def" class="anchor"></a><code><span><span class="keyword">val</span> gen_variant_def : 
  <span><span class="xref-unresolved">Stdlib</span>.Buffer.t <span class="arrow">&#45;&gt;</span></span>
  <span><span>(string * <span><span>(string * <span><a href="../../../spoc/Sarek_ir_types/index.html#type-elttype">Sarek_ir_types.elttype</a> list</span>)</span> list</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Generate GLSL variant type definition</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-generate_with_types"><a href="#val-generate_with_types" class="anchor"></a><code><span><span class="keyword">val</span> generate_with_types : 
  <span><span class="optlabel">?block</span>:<span>(int * int * int)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">types</span>:<span><span>(string * <span><span>(string * <a href="../../../spoc/Sarek_ir_types/index.html#type-elttype">Sarek_ir_types.elttype</a>)</span> list</span>)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../spoc/Sarek_ir_types/index.html#type-kernel">Sarek_ir_types.kernel</a> <span class="arrow">&#45;&gt;</span></span>
  string</span></code></div><div class="spec-doc"><p>Generate GLSL source with custom type definitions.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">block</span> <p>Optional workgroup dimensions (x, y, z). Defaults to 256x1x1.</p></li></ul></div></div></div></body></html>
