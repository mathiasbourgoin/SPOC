<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Vector (sarek.Spoc_core.Vector)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">sarek</a> &#x00BB; <a href="../index.html">Spoc_core</a> &#x00BB; Vector</nav><header class="odoc-preamble"><h1>Module <code><span>Spoc_core.Vector</span></code></h1></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#accessors">Accessors</a></li><li><a href="#raw-data-access">Raw Data Access</a></li><li><a href="#sync-and-host-pointer-helpers-(delegated)">Sync and host pointer helpers (delegated)</a></li><li><a href="#element-access">Element Access</a></li><li><a href="#unsafe-access-(no-bounds-check)">Unsafe Access (no bounds check)</a></li><li><a href="#auto-sync-control">Auto-sync Control</a></li><li><a href="#location-queries">Location Queries</a></li><li><a href="#device-buffer-management">Device Buffer Management</a></li><li><a href="#pretty-printing">Pretty Printing</a></li><li><a href="#convenience-constructors-for-scalar-types">Convenience Constructors for Scalar Types</a></li><li><a href="#initialization-helpers">Initialization Helpers</a></li><li><a href="#subvector-support">Subvector Support</a></li><li><a href="#multi-gpu-helpers">Multi-GPU Helpers</a></li><li><a href="#subvector-queries">Subvector Queries</a></li><li><a href="#phase-6:-vector-utilities">Phase 6: Vector Utilities</a><ul><li><a href="#iteration">Iteration</a></li><li><a href="#mapping">Mapping</a></li><li><a href="#folding">Folding</a></li><li><a href="#predicates">Predicates</a></li><li><a href="#aggregation">Aggregation</a></li><li><a href="#conversion">Conversion</a></li><li><a href="#blitting">Blitting</a></li></ul></li></ul></nav></div><div class="odoc-content"><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <span class="keyword">struct</span> <span class="keyword">include</span> <a href="../Vector_types/index.html">Vector_types</a> <span class="keyword">end</span></span></code></summary><h2 id="element-types"><a href="#element-types" class="anchor"></a>Element Types</h2><div class="odoc-spec"><div class="spec type anchored" id="type-scalar_kind"><a href="#type-scalar_kind" class="anchor"></a><code><span><span class="keyword">type</span> <span>(_, _) scalar_kind</span></span><span> = <span><span>(<span class="type-var">_</span>, <span class="type-var">_</span>)</span> <a href="../Vector_types/index.html#type-scalar_kind">Vector_types.scalar_kind</a></span></span><span> = </span></code><ol><li id="type-scalar_kind.Float32" class="def variant constructor anchored"><a href="#type-scalar_kind.Float32" class="anchor"></a><code><span>| </span><span><span class="constructor">Float32</span> : <span><span>(float, <span class="xref-unresolved">Stdlib</span>.Bigarray.float32_elt)</span> <a href="#type-scalar_kind">scalar_kind</a></span></span></code></li><li id="type-scalar_kind.Float64" class="def variant constructor anchored"><a href="#type-scalar_kind.Float64" class="anchor"></a><code><span>| </span><span><span class="constructor">Float64</span> : <span><span>(float, <span class="xref-unresolved">Stdlib</span>.Bigarray.float64_elt)</span> <a href="#type-scalar_kind">scalar_kind</a></span></span></code></li><li id="type-scalar_kind.Int32" class="def variant constructor anchored"><a href="#type-scalar_kind.Int32" class="anchor"></a><code><span>| </span><span><span class="constructor">Int32</span> : <span><span>(int32, <span class="xref-unresolved">Stdlib</span>.Bigarray.int32_elt)</span> <a href="#type-scalar_kind">scalar_kind</a></span></span></code></li><li id="type-scalar_kind.Int64" class="def variant constructor anchored"><a href="#type-scalar_kind.Int64" class="anchor"></a><code><span>| </span><span><span class="constructor">Int64</span> : <span><span>(int64, <span class="xref-unresolved">Stdlib</span>.Bigarray.int64_elt)</span> <a href="#type-scalar_kind">scalar_kind</a></span></span></code></li><li id="type-scalar_kind.Char" class="def variant constructor anchored"><a href="#type-scalar_kind.Char" class="anchor"></a><code><span>| </span><span><span class="constructor">Char</span> : <span><span>(char, <span class="xref-unresolved">Stdlib</span>.Bigarray.int8_unsigned_elt)</span> <a href="#type-scalar_kind">scalar_kind</a></span></span></code></li><li id="type-scalar_kind.Complex32" class="def variant constructor anchored"><a href="#type-scalar_kind.Complex32" class="anchor"></a><code><span>| </span><span><span class="constructor">Complex32</span> : <span><span>(<span class="xref-unresolved">Stdlib</span>.Complex.t, <span class="xref-unresolved">Stdlib</span>.Bigarray.complex32_elt)</span> <a href="#type-scalar_kind">scalar_kind</a></span></span></code></li></ol></div><div class="spec-doc"><p>Standard numeric kinds backed by Bigarray</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-custom_type"><a href="#type-custom_type" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a custom_type</span></span><span> = <span><span class="type-var">'a</span> <a href="../Vector_types/index.html#type-custom_type">Vector_types.custom_type</a></span></span><span> = </span><span>{</span></code><ol><li id="type-custom_type.elem_size" class="def record field anchored"><a href="#type-custom_type.elem_size" class="anchor"></a><code><span>elem_size : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Size of each element in bytes</p><span class="comment-delim">*)</span></div></li><li id="type-custom_type.get" class="def record field anchored"><a href="#type-custom_type.get" class="anchor"></a><code><span>get : <span><span>unit <span class="xref-unresolved">Ctypes</span>.ptr</span> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Read element at index</p><span class="comment-delim">*)</span></div></li><li id="type-custom_type.set" class="def record field anchored"><a href="#type-custom_type.set" class="anchor"></a><code><span>set : <span><span>unit <span class="xref-unresolved">Ctypes</span>.ptr</span> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Write element at index</p><span class="comment-delim">*)</span></div></li><li id="type-custom_type.name" class="def record field anchored"><a href="#type-custom_type.name" class="anchor"></a><code><span>name : string;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Type name for debugging</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Custom type descriptor for ctypes-based structures</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Custom_helpers"><a href="#module-Custom_helpers" class="anchor"></a><code><span><span class="keyword">module</span> Custom_helpers</span><span> = <a href="../Vector_types/Custom_helpers/index.html">Vector_types.Custom_helpers</a></span></code></div><div class="spec-doc"><p>Helper functions for custom type implementations. These wrap Ctypes operations to provide simpler APIs for PPX-generated code.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-kind"><a href="#type-kind" class="anchor"></a><code><span><span class="keyword">type</span> <span>(_, _) kind</span></span><span> = <span><span>(<span class="type-var">_</span>, <span class="type-var">_</span>)</span> <a href="../Vector_types/index.html#type-kind">Vector_types.kind</a></span></span><span> = </span></code><ol><li id="type-kind.Scalar" class="def variant constructor anchored"><a href="#type-kind.Scalar" class="anchor"></a><code><span>| </span><span><span class="constructor">Scalar</span> : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scalar_kind">scalar_kind</a></span> <span class="arrow">&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-kind">kind</a></span></span></code></li><li id="type-kind.Custom" class="def variant constructor anchored"><a href="#type-kind.Custom" class="anchor"></a><code><span>| </span><span><span class="constructor">Custom</span> : <span><span class="type-var">'a</span> <a href="#type-custom_type">custom_type</a></span> <span class="arrow">&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, unit)</span> <a href="#type-kind">kind</a></span></span></code></li></ol></div><div class="spec-doc"><p>Unified kind type supporting both scalar and custom types</p></div></div><h2 id="kind-helpers"><a href="#kind-helpers" class="anchor"></a>Kind Helpers</h2><div class="odoc-spec"><div class="spec value anchored" id="val-to_bigarray_kind"><a href="#val-to_bigarray_kind" class="anchor"></a><code><span><span class="keyword">val</span> to_bigarray_kind : 
  'a 'b. <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scalar_kind">scalar_kind</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <span class="xref-unresolved">Stdlib</span>.Bigarray.kind</span></span></code></div><div class="spec-doc"><p>Convert scalar kind to Bigarray.kind</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-scalar_elem_size"><a href="#val-scalar_elem_size" class="anchor"></a><code><span><span class="keyword">val</span> scalar_elem_size : 'a 'b. <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scalar_kind">scalar_kind</a></span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>Element size in bytes</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-elem_size"><a href="#val-elem_size" class="anchor"></a><code><span><span class="keyword">val</span> elem_size : 'a 'b. <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-kind">kind</a></span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-scalar_kind_name"><a href="#val-scalar_kind_name" class="anchor"></a><code><span><span class="keyword">val</span> scalar_kind_name : 'a 'b. <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scalar_kind">scalar_kind</a></span> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Kind name for debugging</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-kind_name"><a href="#val-kind_name" class="anchor"></a><code><span><span class="keyword">val</span> kind_name : 'a 'b. <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-kind">kind</a></span> <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><h2 id="host-storage-(gadt)"><a href="#host-storage-(gadt)" class="anchor"></a>Host Storage (GADT)</h2><div class="odoc-spec"><div class="spec type anchored" id="type-host_storage"><a href="#type-host_storage" class="anchor"></a><code><span><span class="keyword">type</span> <span>(_, _) host_storage</span></span><span> = <span><span>(<span class="type-var">_</span>, <span class="type-var">_</span>)</span> <a href="../Vector_types/index.html#type-host_storage">Vector_types.host_storage</a></span></span><span> = </span></code><ol><li id="type-host_storage.Bigarray_storage" class="def variant constructor anchored"><a href="#type-host_storage.Bigarray_storage" class="anchor"></a><code><span>| </span><span><span class="constructor">Bigarray_storage</span> : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="xref-unresolved">Stdlib</span>.Bigarray.c_layout)</span> <span class="xref-unresolved">Stdlib</span>.Bigarray.Array1.t</span> <span class="arrow">&#45;&gt;</span> 
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span>
    <a href="#type-host_storage">host_storage</a></span></span></code></li><li id="type-host_storage.Custom_storage" class="def variant constructor anchored"><a href="#type-host_storage.Custom_storage" class="anchor"></a><code><span>| </span><span><span class="constructor">Custom_storage</span> : </span><span>{</span></code><ol><li id="type-host_storage.ptr" class="def record field anchored"><a href="#type-host_storage.ptr" class="anchor"></a><code><span>ptr : <span>unit <span class="xref-unresolved">Ctypes</span>.ptr</span>;</span></code></li><li id="type-host_storage.custom" class="def record field anchored"><a href="#type-host_storage.custom" class="anchor"></a><code><span>custom : <span><span class="type-var">'a</span> <a href="#type-custom_type">custom_type</a></span>;</span></code></li><li id="type-host_storage.length" class="def record field anchored"><a href="#type-host_storage.length" class="anchor"></a><code><span>length : int;</span></code></li></ol><code><span>}</span><span> <span class="arrow">&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, unit)</span> <a href="#type-host_storage">host_storage</a></span></span></code></li></ol></div><div class="spec-doc"><p>CPU-side storage - either Bigarray or raw ctypes pointer</p></div></div><h2 id="location-tracking"><a href="#location-tracking" class="anchor"></a>Location Tracking</h2><div class="odoc-spec"><div class="spec type anchored" id="type-location"><a href="#type-location" class="anchor"></a><code><span><span class="keyword">type</span> location</span><span> = <a href="../Vector_types/index.html#type-location">Vector_types.location</a></span><span> = </span></code><ol><li id="type-location.CPU" class="def variant constructor anchored"><a href="#type-location.CPU" class="anchor"></a><code><span>| </span><span><span class="constructor">CPU</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Data only on host</p><span class="comment-delim">*)</span></div></li><li id="type-location.GPU" class="def variant constructor anchored"><a href="#type-location.GPU" class="anchor"></a><code><span>| </span><span><span class="constructor">GPU</span> <span class="keyword">of</span> <a href="../Device/index.html#type-t">Device.t</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Data only on specific device</p><span class="comment-delim">*)</span></div></li><li id="type-location.Both" class="def variant constructor anchored"><a href="#type-location.Both" class="anchor"></a><code><span>| </span><span><span class="constructor">Both</span> <span class="keyword">of</span> <a href="../Device/index.html#type-t">Device.t</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Synced on host and device</p><span class="comment-delim">*)</span></div></li><li id="type-location.Stale_CPU" class="def variant constructor anchored"><a href="#type-location.Stale_CPU" class="anchor"></a><code><span>| </span><span><span class="constructor">Stale_CPU</span> <span class="keyword">of</span> <a href="../Device/index.html#type-t">Device.t</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>GPU is authoritative, CPU outdated</p><span class="comment-delim">*)</span></div></li><li id="type-location.Stale_GPU" class="def variant constructor anchored"><a href="#type-location.Stale_GPU" class="anchor"></a><code><span>| </span><span><span class="constructor">Stale_GPU</span> <span class="keyword">of</span> <a href="../Device/index.html#type-t">Device.t</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>CPU is authoritative, GPU outdated</p><span class="comment-delim">*)</span></div></li></ol></div><div class="spec-doc"><p>Where the authoritative copy of data resides</p></div></div><h2 id="device-buffer-abstraction"><a href="#device-buffer-abstraction" class="anchor"></a>Device Buffer Abstraction</h2><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-DEVICE_BUFFER"><a href="#module-type-DEVICE_BUFFER" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> DEVICE_BUFFER</span><span> = <a href="../Memory/module-type-BUFFER/index.html">Vector_types.DEVICE_BUFFER</a></span></code></div><div class="spec-doc"><p>Device buffer reuses Memory.BUFFER module type. We use the raw module type here (not the phantom-typed Memory.buffer) because the hashtable stores buffers for a single vector type, and the type safety comes from the Vector's ('a, 'b) t type parameter.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-device_buffer"><a href="#type-device_buffer" class="anchor"></a><code><span><span class="keyword">type</span> device_buffer</span><span> = <span>(<span class="keyword">module</span> <a href="../Memory/module-type-BUFFER/index.html">DEVICE_BUFFER</a>)</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-device_buffers"><a href="#type-device_buffers" class="anchor"></a><code><span><span class="keyword">type</span> device_buffers</span><span> = <span><span>(int, <a href="#type-device_buffer">device_buffer</a>)</span> <span class="xref-unresolved">Stdlib</span>.Hashtbl.t</span></span></code></div><div class="spec-doc"><p>Device buffer storage - maps device ID to buffer</p></div></div><h2 id="vector-type"><a href="#vector-type" class="anchor"></a>Vector Type</h2><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>('a, 'b) t</span></span><span> = <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span></span><span> = </span><span>{</span></code><ol><li id="type-t.host" class="def record field anchored"><a href="#type-t.host" class="anchor"></a><code><span>host : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-host_storage">host_storage</a></span>;</span></code></li><li id="type-t.device_buffers" class="def record field anchored"><a href="#type-t.device_buffers" class="anchor"></a><code><span>device_buffers : <a href="#type-device_buffers">device_buffers</a>;</span></code></li><li id="type-t.length" class="def record field anchored"><a href="#type-t.length" class="anchor"></a><code><span>length : int;</span></code></li><li id="type-t.kind" class="def record field anchored"><a href="#type-t.kind" class="anchor"></a><code><span>kind : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-kind">kind</a></span>;</span></code></li><li id="type-t.location" class="def record field anchored"><a href="#type-t.location" class="anchor"></a><code><span><span class="keyword">mutable</span> location : <a href="#type-location">location</a>;</span></code></li><li id="type-t.auto_sync" class="def record field anchored"><a href="#type-t.auto_sync" class="anchor"></a><code><span><span class="keyword">mutable</span> auto_sync : bool;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Enable automatic CPU sync on get</p><span class="comment-delim">*)</span></div></li><li id="type-t.id" class="def record field anchored"><a href="#type-t.id" class="anchor"></a><code><span>id : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Unique vector ID for debugging</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>High-level vector with location tracking</p></div></div></details></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_scalar"><a href="#val-create_scalar" class="anchor"></a><code><span><span class="keyword">val</span> create_scalar : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-scalar_kind">Vector_types.scalar_kind</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?dev</span>:<a href="../Device/index.html#type-t">Device.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-kind">Vector_types.kind</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?dev</span>:<a href="../Device/index.html#type-t">Device.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_custom"><a href="#val-create_custom" class="anchor"></a><code><span><span class="keyword">val</span> create_custom : 
  <span><span><span class="type-var">'a</span> <a href="../Vector_types/index.html#type-custom_type">Vector_types.custom_type</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?dev</span>:<a href="../Device/index.html#type-t">Device.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, unit)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-of_bigarray"><a href="#val-of_bigarray" class="anchor"></a><code><span><span class="keyword">val</span> of_bigarray : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-scalar_kind">Vector_types.scalar_kind</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="xref-unresolved">Stdlib</span>.Bigarray.c_layout)</span> <span class="xref-unresolved">Stdlib</span>.Bigarray.Array1.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-of_ctypes_ptr"><a href="#val-of_ctypes_ptr" class="anchor"></a><code><span><span class="keyword">val</span> of_ctypes_ptr : 
  <span><span><span class="type-var">'a</span> <a href="../Vector_types/index.html#type-custom_type">Vector_types.custom_type</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <span class="xref-unresolved">Ctypes</span>.ptr</span> <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, unit)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span></span></code></div></div><h2 id="accessors"><a href="#accessors" class="anchor"></a>Accessors</h2><div class="odoc-spec"><div class="spec value anchored" id="val-length"><a href="#val-length" class="anchor"></a><code><span><span class="keyword">val</span> length : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-kind"><a href="#val-kind" class="anchor"></a><code><span><span class="keyword">val</span> kind : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-kind">kind</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-location"><a href="#val-location" class="anchor"></a><code><span><span class="keyword">val</span> location : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-location">location</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-id"><a href="#val-id" class="anchor"></a><code><span><span class="keyword">val</span> id : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-device"><a href="#val-device" class="anchor"></a><code><span><span class="keyword">val</span> device : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Device/index.html#type-t">Device.t</a> option</span></span></code></div><div class="spec-doc"><p>Get device if vector has GPU data</p></div></div><h2 id="raw-data-access"><a href="#raw-data-access" class="anchor"></a>Raw Data Access</h2><div class="odoc-spec"><div class="spec value anchored" id="val-to_bigarray"><a href="#val-to_bigarray" class="anchor"></a><code><span><span class="keyword">val</span> to_bigarray : 
  'a 'b. <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="xref-unresolved">Stdlib</span>.Bigarray.c_layout)</span> <span class="xref-unresolved">Stdlib</span>.Bigarray.Array1.t</span></span></code></div><div class="spec-doc"><p>Get underlying Bigarray (only for scalar vectors)</p></div></div><h2 id="sync-and-host-pointer-helpers-(delegated)"><a href="#sync-and-host-pointer-helpers-(delegated)" class="anchor"></a>Sync and host pointer helpers (delegated)</h2><div class="odoc-spec"><div class="spec type anchored" id="type-sync_callback"><a href="#type-sync_callback" class="anchor"></a><code><span><span class="keyword">type</span> sync_callback</span><span> = <a href="../Vector_transfer/index.html#type-sync_callback">Vector_transfer.sync_callback</a></span><span> = </span><span>{</span></code><ol><li id="type-sync_callback.sync" class="def record field anchored"><a href="#type-sync_callback.sync" class="anchor"></a><code><span>sync : 'a 'b. <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> bool;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_ctypes_ptr"><a href="#val-to_ctypes_ptr" class="anchor"></a><code><span><span class="keyword">val</span> to_ctypes_ptr : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Ctypes</span>.ptr</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-host_ptr"><a href="#val-host_ptr" class="anchor"></a><code><span><span class="keyword">val</span> host_ptr : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span> <span class="arrow">&#45;&gt;</span></span> nativeint</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-register_sync_callback"><a href="#val-register_sync_callback" class="anchor"></a><code><span><span class="keyword">val</span> register_sync_callback : <span><a href="../Vector_transfer/index.html#type-sync_callback">Vector_transfer.sync_callback</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ensure_cpu_sync"><a href="#val-ensure_cpu_sync" class="anchor"></a><code><span><span class="keyword">val</span> ensure_cpu_sync : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><h2 id="element-access"><a href="#element-access" class="anchor"></a>Element Access</h2><div class="odoc-spec"><div class="spec value anchored" id="val-get"><a href="#val-get" class="anchor"></a><code><span><span class="keyword">val</span> get : 'a 'b. <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>Get element (works for both storage types). Auto-syncs from GPU if location is Stale_CPU and auto_sync is enabled.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set"><a href="#val-set" class="anchor"></a><code><span><span class="keyword">val</span> set : 'a 'b. <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Set element (works for both storage types)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(.%[])"><a href="#val-(.%[])" class="anchor"></a><code><span><span class="keyword">val</span> (.%[]) : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>Indexing operators</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(.%[]&lt;-)"><a href="#val-(.%[]&lt;-)" class="anchor"></a><code><span><span class="keyword">val</span> (.%[]&lt;-) : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><h2 id="unsafe-access-(no-bounds-check)"><a href="#unsafe-access-(no-bounds-check)" class="anchor"></a>Unsafe Access (no bounds check)</h2><div class="odoc-spec"><div class="spec value anchored" id="val-unsafe_get"><a href="#val-unsafe_get" class="anchor"></a><code><span><span class="keyword">val</span> unsafe_get : 'a 'b. <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-unsafe_set"><a href="#val-unsafe_set" class="anchor"></a><code><span><span class="keyword">val</span> unsafe_set : 'a 'b. <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-kernel_set"><a href="#val-kernel_set" class="anchor"></a><code><span><span class="keyword">val</span> kernel_set : 'a 'b. <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Kernel-safe set: no bounds check, no location update. Use this in parallel kernel execution where:</p><ul><li>Bounds are guaranteed by kernel logic</li><li>Location tracking is not needed (data stays on same device)</li><li>Multiple threads may write to different indices concurrently</li></ul></div></div><h2 id="auto-sync-control"><a href="#auto-sync-control" class="anchor"></a>Auto-sync Control</h2><div class="odoc-spec"><div class="spec value anchored" id="val-set_auto_sync"><a href="#val-set_auto_sync" class="anchor"></a><code><span><span class="keyword">val</span> set_auto_sync : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>bool <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-auto_sync"><a href="#val-auto_sync" class="anchor"></a><code><span><span class="keyword">val</span> auto_sync : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><h2 id="location-queries"><a href="#location-queries" class="anchor"></a>Location Queries</h2><div class="odoc-spec"><div class="spec value anchored" id="val-is_on_cpu"><a href="#val-is_on_cpu" class="anchor"></a><code><span><span class="keyword">val</span> is_on_cpu : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_on_gpu"><a href="#val-is_on_gpu" class="anchor"></a><code><span><span class="keyword">val</span> is_on_gpu : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_synced"><a href="#val-is_synced" class="anchor"></a><code><span><span class="keyword">val</span> is_synced : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-needs_gpu_update"><a href="#val-needs_gpu_update" class="anchor"></a><code><span><span class="keyword">val</span> needs_gpu_update : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-needs_cpu_update"><a href="#val-needs_cpu_update" class="anchor"></a><code><span><span class="keyword">val</span> needs_cpu_update : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><h2 id="device-buffer-management"><a href="#device-buffer-management" class="anchor"></a>Device Buffer Management</h2><div class="odoc-spec"><div class="spec value anchored" id="val-has_buffer"><a href="#val-has_buffer" class="anchor"></a><code><span><span class="keyword">val</span> has_buffer : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Device/index.html#type-t">Device.t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Check if vector has buffer on specific device</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_buffer"><a href="#val-get_buffer" class="anchor"></a><code><span><span class="keyword">val</span> get_buffer : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Device/index.html#type-t">Device.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Vector_types/index.html#type-device_buffer">Vector_types.device_buffer</a> option</span></span></code></div><div class="spec-doc"><p>Get device buffer if allocated</p></div></div><h2 id="pretty-printing"><a href="#pretty-printing" class="anchor"></a>Pretty Printing</h2><div class="odoc-spec"><div class="spec value anchored" id="val-location_to_string"><a href="#val-location_to_string" class="anchor"></a><code><span><span class="keyword">val</span> location_to_string : <span><a href="#type-location">location</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_string"><a href="#val-to_string" class="anchor"></a><code><span><span class="keyword">val</span> to_string : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><h2 id="convenience-constructors-for-scalar-types"><a href="#convenience-constructors-for-scalar-types" class="anchor"></a>Convenience Constructors for Scalar Types</h2><div class="odoc-spec"><div class="spec value anchored" id="val-float32"><a href="#val-float32" class="anchor"></a><code><span><span class="keyword">val</span> float32 : <span><span>(float, <span class="xref-unresolved">Stdlib</span>.Bigarray.float32_elt)</span> <a href="#type-kind">kind</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-float64"><a href="#val-float64" class="anchor"></a><code><span><span class="keyword">val</span> float64 : <span><span>(float, <span class="xref-unresolved">Stdlib</span>.Bigarray.float64_elt)</span> <a href="#type-kind">kind</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-int32"><a href="#val-int32" class="anchor"></a><code><span><span class="keyword">val</span> int32 : <span><span>(int32, <span class="xref-unresolved">Stdlib</span>.Bigarray.int32_elt)</span> <a href="#type-kind">kind</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-int64"><a href="#val-int64" class="anchor"></a><code><span><span class="keyword">val</span> int64 : <span><span>(int64, <span class="xref-unresolved">Stdlib</span>.Bigarray.int64_elt)</span> <a href="#type-kind">kind</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-char"><a href="#val-char" class="anchor"></a><code><span><span class="keyword">val</span> char : <span><span>(char, <span class="xref-unresolved">Stdlib</span>.Bigarray.int8_unsigned_elt)</span> <a href="#type-kind">kind</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-complex32"><a href="#val-complex32" class="anchor"></a><code><span><span class="keyword">val</span> complex32 : <span><span>(<span class="xref-unresolved">Stdlib</span>.Complex.t, <span class="xref-unresolved">Stdlib</span>.Bigarray.complex32_elt)</span> <a href="#type-kind">kind</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_float32"><a href="#val-create_float32" class="anchor"></a><code><span><span class="keyword">val</span> create_float32 : 
  <span><span class="optlabel">?dev</span>:<a href="../Device/index.html#type-t">Device.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(float, <span class="xref-unresolved">Stdlib</span>.Bigarray.float32_elt)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_float64"><a href="#val-create_float64" class="anchor"></a><code><span><span class="keyword">val</span> create_float64 : 
  <span><span class="optlabel">?dev</span>:<a href="../Device/index.html#type-t">Device.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(float, <span class="xref-unresolved">Stdlib</span>.Bigarray.float64_elt)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_int32"><a href="#val-create_int32" class="anchor"></a><code><span><span class="keyword">val</span> create_int32 : 
  <span><span class="optlabel">?dev</span>:<a href="../Device/index.html#type-t">Device.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(int32, <span class="xref-unresolved">Stdlib</span>.Bigarray.int32_elt)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_int64"><a href="#val-create_int64" class="anchor"></a><code><span><span class="keyword">val</span> create_int64 : 
  <span><span class="optlabel">?dev</span>:<a href="../Device/index.html#type-t">Device.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(int64, <span class="xref-unresolved">Stdlib</span>.Bigarray.int64_elt)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span></span></code></div></div><h2 id="initialization-helpers"><a href="#initialization-helpers" class="anchor"></a>Initialization Helpers</h2><div class="odoc-spec"><div class="spec value anchored" id="val-fill"><a href="#val-fill" class="anchor"></a><code><span><span class="keyword">val</span> fill : 'a 'b. <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Fill vector with a value</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-init"><a href="#val-init" class="anchor"></a><code><span><span class="keyword">val</span> init : 'a 'b. <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-kind">kind</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Initialize with a function</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-copy"><a href="#val-copy" class="anchor"></a><code><span><span class="keyword">val</span> copy : 'a 'b. <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Copy vector (CPU data only, auto-syncs source if needed)</p></div></div><h2 id="subvector-support"><a href="#subvector-support" class="anchor"></a>Subvector Support</h2><div class="odoc-spec"><div class="spec type anchored" id="type-sub_meta"><a href="#type-sub_meta" class="anchor"></a><code><span><span class="keyword">type</span> sub_meta</span><span> = <a href="../Vector_storage/index.html#type-sub_meta">Vector_storage.sub_meta</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_sub"><a href="#val-is_sub" class="anchor"></a><code><span><span class="keyword">val</span> is_sub : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_sub_meta"><a href="#val-get_sub_meta" class="anchor"></a><code><span><span class="keyword">val</span> get_sub_meta : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Vector_storage/index.html#type-sub_meta">Vector_storage.sub_meta</a> option</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sub_vector"><a href="#val-sub_vector" class="anchor"></a><code><span><span class="keyword">val</span> sub_vector : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">start</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">len</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?ok_range</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?ko_range</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Create a subvector that shares CPU memory with parent.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">vec</span> <p>Parent vector</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">start</span> <p>Starting index in parent</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">len</span> <p>Length of subvector</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">ok_range</span> <p>Elements safe to read (default: len)</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">ko_range</span> <p>Elements to avoid writing (default: 0)</p></li></ul></div></div><h2 id="multi-gpu-helpers"><a href="#multi-gpu-helpers" class="anchor"></a>Multi-GPU Helpers</h2><div class="odoc-spec"><div class="spec value anchored" id="val-partition"><a href="#val-partition" class="anchor"></a><code><span><span class="keyword">val</span> partition : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../Device/index.html#type-t">Device.t</a> array</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> array</span></span></code></div><div class="spec-doc"><p>Partition a vector across multiple devices. Creates subvectors, one per device, that together cover the full vector.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gather"><a href="#val-gather" class="anchor"></a><code><span><span class="keyword">val</span> gather : <span><span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> array</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Gather subvectors back to parent (sync all to CPU). Assumes subvectors were created by partition and don't overlap.</p></div></div><h2 id="subvector-queries"><a href="#subvector-queries" class="anchor"></a>Subvector Queries</h2><div class="odoc-spec"><div class="spec value anchored" id="val-depth"><a href="#val-depth" class="anchor"></a><code><span><span class="keyword">val</span> depth : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>Get subvector depth (0 = root, 1 = child, 2 = grandchild, ...)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-parent_id"><a href="#val-parent_id" class="anchor"></a><code><span><span class="keyword">val</span> parent_id : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int option</span></span></code></div><div class="spec-doc"><p>Get parent vector ID if this is a subvector</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sub_start"><a href="#val-sub_start" class="anchor"></a><code><span><span class="keyword">val</span> sub_start : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int option</span></span></code></div><div class="spec-doc"><p>Get start offset relative to immediate parent</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sub_ok_range"><a href="#val-sub_ok_range" class="anchor"></a><code><span><span class="keyword">val</span> sub_ok_range : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int option</span></span></code></div><div class="spec-doc"><p>Get ok_range (safe read range)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sub_ko_range"><a href="#val-sub_ko_range" class="anchor"></a><code><span><span class="keyword">val</span> sub_ko_range : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int option</span></span></code></div><div class="spec-doc"><p>Get ko_range (unsafe write range)</p></div></div><h2 id="phase-6:-vector-utilities"><a href="#phase-6:-vector-utilities" class="anchor"></a>Phase 6: Vector Utilities</h2><h3 id="iteration"><a href="#iteration" class="anchor"></a>Iteration</h3><div class="odoc-spec"><div class="spec value anchored" id="val-iter"><a href="#val-iter" class="anchor"></a><code><span><span class="keyword">val</span> iter : 'a 'b. <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Iterate over all elements (CPU-side, auto-syncs if needed)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-iteri"><a href="#val-iteri" class="anchor"></a><code><span><span class="keyword">val</span> iteri : 'a 'b. <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Iterate with index</p></div></div><h3 id="mapping"><a href="#mapping" class="anchor"></a>Mapping</h3><div class="odoc-spec"><div class="spec value anchored" id="val-map"><a href="#val-map" class="anchor"></a><code><span><span class="keyword">val</span> map : 'a 'b 'c 'd. <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'c</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'c</span>, <span class="type-var">'d</span>)</span> <a href="#type-kind">kind</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'c</span>, <span class="type-var">'d</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Map function over vector, creating new vector with given kind</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mapi"><a href="#val-mapi" class="anchor"></a><code><span><span class="keyword">val</span> mapi : 
  'a 'b 'c 'd. <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'c</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'c</span>, <span class="type-var">'d</span>)</span> <a href="#type-kind">kind</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'c</span>, <span class="type-var">'d</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Map with index</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-map_inplace"><a href="#val-map_inplace" class="anchor"></a><code><span><span class="keyword">val</span> map_inplace : 'a 'b. <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>In-place map (same type)</p></div></div><h3 id="folding"><a href="#folding" class="anchor"></a>Folding</h3><div class="odoc-spec"><div class="spec value anchored" id="val-fold_left"><a href="#val-fold_left" class="anchor"></a><code><span><span class="keyword">val</span> fold_left : 'a 'b 'acc. <span><span>(<span><span class="type-var">'acc</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'acc</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'acc</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'acc</span></span></code></div><div class="spec-doc"><p>Fold left</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fold_right"><a href="#val-fold_right" class="anchor"></a><code><span><span class="keyword">val</span> fold_right : 'a 'b 'acc. <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'acc</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'acc</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'acc</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'acc</span></span></code></div><div class="spec-doc"><p>Fold right</p></div></div><h3 id="predicates"><a href="#predicates" class="anchor"></a>Predicates</h3><div class="odoc-spec"><div class="spec value anchored" id="val-for_all"><a href="#val-for_all" class="anchor"></a><code><span><span class="keyword">val</span> for_all : 'a 'b. <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Check if all elements satisfy predicate</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-exists"><a href="#val-exists" class="anchor"></a><code><span><span class="keyword">val</span> exists : 'a 'b. <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Check if any element satisfies predicate</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find"><a href="#val-find" class="anchor"></a><code><span><span class="keyword">val</span> find : 'a 'b. <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> option</span></span></code></div><div class="spec-doc"><p>Find first element satisfying predicate</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_index"><a href="#val-find_index" class="anchor"></a><code><span><span class="keyword">val</span> find_index : 'a 'b. <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int option</span></span></code></div><div class="spec-doc"><p>Find index of first element satisfying predicate</p></div></div><h3 id="aggregation"><a href="#aggregation" class="anchor"></a>Aggregation</h3><div class="odoc-spec"><div class="spec value anchored" id="val-sum"><a href="#val-sum" class="anchor"></a><code><span><span class="keyword">val</span> sum : <span><span class="label">zero</span>:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">add</span>:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>Sum elements (requires + operation via fold)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-min_elt"><a href="#val-min_elt" class="anchor"></a><code><span><span class="keyword">val</span> min_elt : <span><span class="label">compare</span>:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> int)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> option</span></span></code></div><div class="spec-doc"><p>Find minimum element</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-max_elt"><a href="#val-max_elt" class="anchor"></a><code><span><span class="keyword">val</span> max_elt : <span><span class="label">compare</span>:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> int)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> option</span></span></code></div><div class="spec-doc"><p>Find maximum element</p></div></div><h3 id="conversion"><a href="#conversion" class="anchor"></a>Conversion</h3><div class="odoc-spec"><div class="spec value anchored" id="val-to_list"><a href="#val-to_list" class="anchor"></a><code><span><span class="keyword">val</span> to_list : 'a 'b. <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> list</span></span></code></div><div class="spec-doc"><p>Convert to OCaml list</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-of_list"><a href="#val-of_list" class="anchor"></a><code><span><span class="keyword">val</span> of_list : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-kind">Vector_types.kind</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span></span></code></div><div class="spec-doc"><p>Create from OCaml list</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_array"><a href="#val-to_array" class="anchor"></a><code><span><span class="keyword">val</span> to_array : 'a 'b. <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> array</span></span></code></div><div class="spec-doc"><p>Convert to OCaml array</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-of_array"><a href="#val-of_array" class="anchor"></a><code><span><span class="keyword">val</span> of_array : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-kind">Vector_types.kind</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> array</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span></span></code></div><div class="spec-doc"><p>Create from OCaml array</p></div></div><h3 id="blitting"><a href="#blitting" class="anchor"></a>Blitting</h3><div class="odoc-spec"><div class="spec value anchored" id="val-blit"><a href="#val-blit" class="anchor"></a><code><span><span class="keyword">val</span> blit : 
  'a 'b. <span><span class="label">src</span>:<span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">src_off</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">dst</span>:<span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">dst_off</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">len</span>:int <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Copy elements from one vector to another</p></div></div></div></body></html>
