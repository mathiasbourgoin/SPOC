<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Transfer (sarek.Spoc_core.Transfer)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">sarek</a> &#x00BB; <a href="../index.html">Spoc_core</a> &#x00BB; Transfer</nav><header class="odoc-preamble"><h1>Module <code><span>Spoc_core.Transfer</span></code></h1></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#auto-transfer-mode">Auto-Transfer Mode</a></li><li><a href="#device-buffer-allocation">Device Buffer Allocation</a></li><li><a href="#buffer-management-for-vectors">Buffer Management for Vectors</a></li><li><a href="#transfer-operations">Transfer Operations</a></li><li><a href="#buffer-cleanup">Buffer Cleanup</a></li><li><a href="#device-synchronization">Device Synchronization</a></li><li><a href="#stream-operations">Stream Operations</a></li><li><a href="#batch-operations">Batch Operations</a></li><li><a href="#auto-sync-callback-registration">Auto-sync Callback Registration</a></li></ul></nav></div><div class="odoc-content"><h2 id="auto-transfer-mode"><a href="#auto-transfer-mode" class="anchor"></a>Auto-Transfer Mode</h2><div class="odoc-spec"><div class="spec value anchored" id="val-auto_mode"><a href="#val-auto_mode" class="anchor"></a><code><span><span class="keyword">val</span> auto_mode : <span>bool <span class="xref-unresolved">Stdlib</span>.ref</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-enable_auto"><a href="#val-enable_auto" class="anchor"></a><code><span><span class="keyword">val</span> enable_auto : <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-disable_auto"><a href="#val-disable_auto" class="anchor"></a><code><span><span class="keyword">val</span> disable_auto : <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_auto"><a href="#val-is_auto" class="anchor"></a><code><span><span class="keyword">val</span> is_auto : <span>unit <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_auto"><a href="#val-set_auto" class="anchor"></a><code><span><span class="keyword">val</span> set_auto : <span>bool <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><h2 id="device-buffer-allocation"><a href="#device-buffer-allocation" class="anchor"></a>Device Buffer Allocation</h2><div class="odoc-spec"><div class="spec value anchored" id="val-alloc_scalar_buffer"><a href="#val-alloc_scalar_buffer" class="anchor"></a><code><span><span class="keyword">val</span> alloc_scalar_buffer : 
  <span><a href="../Device/index.html#type-t">Device.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector/index.html#type-scalar_kind">Vector.scalar_kind</a></span> <span class="arrow">&#45;&gt;</span></span>
  <a href="../Vector/index.html#type-device_buffer">Vector.device_buffer</a></span></code></div><div class="spec-doc"><p>Allocate a device buffer for a scalar vector, returning a DEVICE_BUFFER module. The buffer is packaged with its backend for type-safe operations.</p><p>For CPU devices (OpenCL CPU, Native), uses zero-copy allocation when possible to avoid memory transfers entirely.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-alloc_scalar_buffer_zero_copy"><a href="#val-alloc_scalar_buffer_zero_copy" class="anchor"></a><code><span><span class="keyword">val</span> alloc_scalar_buffer_zero_copy : 
  <span><a href="../Device/index.html#type-t">Device.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="xref-unresolved">Stdlib</span>.Bigarray.c_layout)</span> <span class="xref-unresolved">Stdlib</span>.Bigarray.Array1.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector/index.html#type-scalar_kind">Vector.scalar_kind</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Vector/index.html#type-device_buffer">Vector.device_buffer</a> option</span></span></code></div><div class="spec-doc"><p>Allocate a device buffer using zero-copy (host memory sharing) if supported. Returns None if the backend doesn't support zero-copy for this device.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-alloc_custom_buffer"><a href="#val-alloc_custom_buffer" class="anchor"></a><code><span><span class="keyword">val</span> alloc_custom_buffer : <span><a href="../Device/index.html#type-t">Device.t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <a href="../Vector/index.html#type-device_buffer">Vector.device_buffer</a></span></code></div><div class="spec-doc"><p>Allocate a device buffer for a custom vector</p></div></div><h2 id="buffer-management-for-vectors"><a href="#buffer-management-for-vectors" class="anchor"></a>Buffer Management for Vectors</h2><div class="odoc-spec"><div class="spec value anchored" id="val-ensure_buffer"><a href="#val-ensure_buffer" class="anchor"></a><code><span><span class="keyword">val</span> ensure_buffer : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector/index.html#type-t">Vector.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Device/index.html#type-t">Device.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Vector/index.html#type-device_buffer">Vector.device_buffer</a></span></code></div><div class="spec-doc"><p>Ensure vector has a device buffer, allocating if needed. For backends that support zero-copy (typically CPU backends), automatically uses zero-copy to avoid memory transfer overhead. The backend decides via alloc_zero_copy.</p></div></div><h2 id="transfer-operations"><a href="#transfer-operations" class="anchor"></a>Transfer Operations</h2><div class="odoc-spec"><div class="spec value anchored" id="val-to_device"><a href="#val-to_device" class="anchor"></a><code><span><span class="keyword">val</span> to_device : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector/index.html#type-t">Vector.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Device/index.html#type-t">Device.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Transfer vector data to a device</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_cpu"><a href="#val-to_cpu" class="anchor"></a><code><span><span class="keyword">val</span> to_cpu : <span><span class="optlabel">?force</span>:bool <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector/index.html#type-t">Vector.t</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Transfer vector data from device to CPU.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">force</span> <p>If true, always transfer even if location is Both (useful after kernel writes)</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sync"><a href="#val-sync" class="anchor"></a><code><span><span class="keyword">val</span> sync : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector/index.html#type-t">Vector.t</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Ensure vector is fully synchronized</p></div></div><h2 id="buffer-cleanup"><a href="#buffer-cleanup" class="anchor"></a>Buffer Cleanup</h2><div class="odoc-spec"><div class="spec value anchored" id="val-free_buffer"><a href="#val-free_buffer" class="anchor"></a><code><span><span class="keyword">val</span> free_buffer : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector/index.html#type-t">Vector.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Device/index.html#type-t">Device.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Free device buffer for a vector</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-free_all_buffers"><a href="#val-free_all_buffers" class="anchor"></a><code><span><span class="keyword">val</span> free_all_buffers : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector/index.html#type-t">Vector.t</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Free all device buffers for a vector</p></div></div><h2 id="device-synchronization"><a href="#device-synchronization" class="anchor"></a>Device Synchronization</h2><div class="odoc-spec"><div class="spec value anchored" id="val-flush"><a href="#val-flush" class="anchor"></a><code><span><span class="keyword">val</span> flush : <span><a href="../Device/index.html#type-t">Device.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Synchronize all pending operations on a device</p></div></div><h2 id="stream-operations"><a href="#stream-operations" class="anchor"></a>Stream Operations</h2><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-STREAM"><a href="#module-type-STREAM" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-STREAM/index.html">STREAM</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Stream handle - packages backend stream with its operations</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-stream"><a href="#type-stream" class="anchor"></a><code><span><span class="keyword">type</span> stream</span><span> = <span>(<span class="keyword">module</span> <a href="module-type-STREAM/index.html">STREAM</a>)</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_stream"><a href="#val-create_stream" class="anchor"></a><code><span><span class="keyword">val</span> create_stream : <span><a href="../Device/index.html#type-t">Device.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-stream">stream</a></span></code></div><div class="spec-doc"><p>Create a new stream on a device</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-default_stream"><a href="#val-default_stream" class="anchor"></a><code><span><span class="keyword">val</span> default_stream : <span><a href="../Device/index.html#type-t">Device.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-stream">stream</a></span></code></div><div class="spec-doc"><p>Get default stream for a device</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-synchronize_stream"><a href="#val-synchronize_stream" class="anchor"></a><code><span><span class="keyword">val</span> synchronize_stream : <span><a href="#type-stream">stream</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-destroy_stream"><a href="#val-destroy_stream" class="anchor"></a><code><span><span class="keyword">val</span> destroy_stream : <span><a href="#type-stream">stream</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><h2 id="batch-operations"><a href="#batch-operations" class="anchor"></a>Batch Operations</h2><div class="odoc-spec"><div class="spec value anchored" id="val-to_device_all"><a href="#val-to_device_all" class="anchor"></a><code><span><span class="keyword">val</span> to_device_all : <span><span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector/index.html#type-t">Vector.t</a></span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Device/index.html#type-t">Device.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_cpu_all"><a href="#val-to_cpu_all" class="anchor"></a><code><span><span class="keyword">val</span> to_cpu_all : <span><span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector/index.html#type-t">Vector.t</a></span> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sync_all"><a href="#val-sync_all" class="anchor"></a><code><span><span class="keyword">val</span> sync_all : <span><span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector/index.html#type-t">Vector.t</a></span> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><h2 id="auto-sync-callback-registration"><a href="#auto-sync-callback-registration" class="anchor"></a>Auto-sync Callback Registration</h2></div></body></html>
