<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Sarek_ir_interp (sarek.Sarek.Sarek_ir_interp)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">sarek</a> &#x00BB; <a href="../index.html">Sarek</a> &#x00BB; Sarek_ir_interp</nav><header class="odoc-preamble"><h1>Module <code><span>Sarek.Sarek_ir_interp</span></code></h1></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#bsp-barrier-effect">BSP Barrier Effect</a></li><li><a href="#thread-state">Thread State</a></li><li><a href="#environment">Environment</a></li><li><a href="#value-operations">Value Operations</a></li><li><a href="#binary-operations">Binary Operations</a></li><li><a href="#intrinsics">Intrinsics</a></li><li><a href="#intrinsic-evaluation-helpers">Intrinsic Evaluation Helpers</a></li><li><a href="#expression-evaluation">Expression Evaluation</a></li><li><a href="#statement-execution">Statement Execution</a></li><li><a href="#kernel-execution">Kernel Execution</a></li><li><a href="#domain-pool-for-parallel-execution">Domain Pool for Parallel Execution</a></li><li><a href="#public-api">Public API</a></li><li><a href="#v2-vector-support">V2 Vector Support</a></li></ul></nav></div><div class="odoc-content"><div class="odoc-spec"><div class="spec module anchored" id="module-F32"><a href="#module-F32" class="anchor"></a><code><span><span class="keyword">module</span> F32</span><span> = <a href="../Sarek_float32/index.html">Sarek_float32</a></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-value"><a href="#type-value" class="anchor"></a><code><span><span class="keyword">type</span> value</span><span> = <a href="../Sarek_value/index.html#type-value">Sarek_value.value</a></span><span> = </span></code><ol><li id="type-value.VInt32" class="def variant constructor anchored"><a href="#type-value.VInt32" class="anchor"></a><code><span>| </span><span><span class="constructor">VInt32</span> <span class="keyword">of</span> int32</span></code></li><li id="type-value.VInt64" class="def variant constructor anchored"><a href="#type-value.VInt64" class="anchor"></a><code><span>| </span><span><span class="constructor">VInt64</span> <span class="keyword">of</span> int64</span></code></li><li id="type-value.VFloat32" class="def variant constructor anchored"><a href="#type-value.VFloat32" class="anchor"></a><code><span>| </span><span><span class="constructor">VFloat32</span> <span class="keyword">of</span> float</span></code></li><li id="type-value.VFloat64" class="def variant constructor anchored"><a href="#type-value.VFloat64" class="anchor"></a><code><span>| </span><span><span class="constructor">VFloat64</span> <span class="keyword">of</span> float</span></code></li><li id="type-value.VBool" class="def variant constructor anchored"><a href="#type-value.VBool" class="anchor"></a><code><span>| </span><span><span class="constructor">VBool</span> <span class="keyword">of</span> bool</span></code></li><li id="type-value.VUnit" class="def variant constructor anchored"><a href="#type-value.VUnit" class="anchor"></a><code><span>| </span><span><span class="constructor">VUnit</span></span></code></li><li id="type-value.VArray" class="def variant constructor anchored"><a href="#type-value.VArray" class="anchor"></a><code><span>| </span><span><span class="constructor">VArray</span> <span class="keyword">of</span> <span><a href="#type-value">value</a> array</span></span></code></li><li id="type-value.VRecord" class="def variant constructor anchored"><a href="#type-value.VRecord" class="anchor"></a><code><span>| </span><span><span class="constructor">VRecord</span> <span class="keyword">of</span> string * <span><a href="#type-value">value</a> array</span></span></code></li><li id="type-value.VVariant" class="def variant constructor anchored"><a href="#type-value.VVariant" class="anchor"></a><code><span>| </span><span><span class="constructor">VVariant</span> <span class="keyword">of</span> string * int * <span><a href="#type-value">value</a> list</span></span></code></li></ol></div><div class="spec-doc"><p>Re-export value type from Sarek_value for convenience</p></div></div><h2 id="bsp-barrier-effect"><a href="#bsp-barrier-effect" class="anchor"></a>BSP Barrier Effect</h2><p>Used for synchronizing threads at barriers. Each thread is suspended when it hits a barrier, and all threads are resumed together.</p><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Barrier"><a href="#extension-decl-Barrier" class="anchor"></a><code><span><span class="keyword">type</span> <span class="xref-unresolved">Stdlib</span>.Effect.t += </span></code><ol><li id="extension-Barrier" class="def variant extension anchored"><a href="#extension-Barrier" class="anchor"></a><code><span>| </span><span><span class="extension">Barrier</span> : <span>unit <span class="xref-unresolved">Stdlib</span>.Effect.t</span></span></code></li></ol></div></div><h2 id="thread-state"><a href="#thread-state" class="anchor"></a>Thread State</h2><div class="odoc-spec"><div class="spec type anchored" id="type-thread_state"><a href="#type-thread_state" class="anchor"></a><code><span><span class="keyword">type</span> thread_state</span><span> = </span><span>{</span></code><ol><li id="type-thread_state.thread_idx" class="def record field anchored"><a href="#type-thread_state.thread_idx" class="anchor"></a><code><span>thread_idx : int * int * int;</span></code></li><li id="type-thread_state.block_idx" class="def record field anchored"><a href="#type-thread_state.block_idx" class="anchor"></a><code><span>block_idx : int * int * int;</span></code></li><li id="type-thread_state.block_dim" class="def record field anchored"><a href="#type-thread_state.block_dim" class="anchor"></a><code><span>block_dim : int * int * int;</span></code></li><li id="type-thread_state.grid_dim" class="def record field anchored"><a href="#type-thread_state.grid_dim" class="anchor"></a><code><span>grid_dim : int * int * int;</span></code></li></ol><code><span>}</span></code></div></div><h2 id="environment"><a href="#environment" class="anchor"></a>Environment</h2><div class="odoc-spec"><div class="spec type anchored" id="type-env"><a href="#type-env" class="anchor"></a><code><span><span class="keyword">type</span> env</span><span> = </span><span>{</span></code><ol><li id="type-env.vars" class="def record field anchored"><a href="#type-env.vars" class="anchor"></a><code><span>vars : <span><span>(int, <a href="#type-value">value</a>)</span> <span class="xref-unresolved">Stdlib</span>.Hashtbl.t</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>var_id -&gt; value</p><span class="comment-delim">*)</span></div></li><li id="type-env.vars_by_name" class="def record field anchored"><a href="#type-env.vars_by_name" class="anchor"></a><code><span>vars_by_name : <span><span>(string, <a href="#type-value">value</a>)</span> <span class="xref-unresolved">Stdlib</span>.Hashtbl.t</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>var_name -&gt; value (fallback)</p><span class="comment-delim">*)</span></div></li><li id="type-env.arrays" class="def record field anchored"><a href="#type-env.arrays" class="anchor"></a><code><span>arrays : <span><span>(string, <span><a href="#type-value">value</a> array</span>)</span> <span class="xref-unresolved">Stdlib</span>.Hashtbl.t</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>array_name -&gt; data</p><span class="comment-delim">*)</span></div></li><li id="type-env.shared" class="def record field anchored"><a href="#type-env.shared" class="anchor"></a><code><span>shared : <span><span>(string, <span><a href="#type-value">value</a> array</span>)</span> <span class="xref-unresolved">Stdlib</span>.Hashtbl.t</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>shared arrays for block</p><span class="comment-delim">*)</span></div></li><li id="type-env.funcs" class="def record field anchored"><a href="#type-env.funcs" class="anchor"></a><code><span>funcs : <span><span>(string, <a href="../../../spoc/Sarek_ir_types/index.html#type-helper_func">Sarek_ir_types.helper_func</a>)</span> <span class="xref-unresolved">Stdlib</span>.Hashtbl.t</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>helper functions</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_env"><a href="#val-create_env" class="anchor"></a><code><span><span class="keyword">val</span> create_env : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-env">env</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-copy_env"><a href="#val-copy_env" class="anchor"></a><code><span><span class="keyword">val</span> copy_env : <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-env">env</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bind_var"><a href="#val-bind_var" class="anchor"></a><code><span><span class="keyword">val</span> bind_var : <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../spoc/Sarek_ir_types/index.html#type-var">Sarek_ir_types.var</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-value">value</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Bind a variable in the environment (both by id and name)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-lookup_var"><a href="#val-lookup_var" class="anchor"></a><code><span><span class="keyword">val</span> lookup_var : <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../spoc/Sarek_ir_types/index.html#type-var">Sarek_ir_types.var</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-value">value</a></span></code></div><div class="spec-doc"><p>Look up a variable (try id first, then name as fallback)</p></div></div><h2 id="value-operations"><a href="#value-operations" class="anchor"></a>Value Operations</h2><div class="odoc-spec"><div class="spec value anchored" id="val-to_int32"><a href="#val-to_int32" class="anchor"></a><code><span><span class="keyword">val</span> to_int32 : <span><a href="#type-value">value</a> <span class="arrow">&#45;&gt;</span></span> int32</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_int64"><a href="#val-to_int64" class="anchor"></a><code><span><span class="keyword">val</span> to_int64 : <span><a href="#type-value">value</a> <span class="arrow">&#45;&gt;</span></span> int64</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_int"><a href="#val-to_int" class="anchor"></a><code><span><span class="keyword">val</span> to_int : <span><a href="#type-value">value</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_float32"><a href="#val-to_float32" class="anchor"></a><code><span><span class="keyword">val</span> to_float32 : <span><a href="#type-value">value</a> <span class="arrow">&#45;&gt;</span></span> float</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_float64"><a href="#val-to_float64" class="anchor"></a><code><span><span class="keyword">val</span> to_float64 : <span><a href="#type-value">value</a> <span class="arrow">&#45;&gt;</span></span> float</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_bool"><a href="#val-to_bool" class="anchor"></a><code><span><span class="keyword">val</span> to_bool : <span><a href="#type-value">value</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><h2 id="binary-operations"><a href="#binary-operations" class="anchor"></a>Binary Operations</h2><div class="odoc-spec"><div class="spec value anchored" id="val-eval_binop"><a href="#val-eval_binop" class="anchor"></a><code><span><span class="keyword">val</span> eval_binop : <span><a href="../../../spoc/Sarek_ir_types/index.html#type-binop">Sarek_ir_types.binop</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-value">value</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-value">value</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-value">value</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-eval_unop"><a href="#val-eval_unop" class="anchor"></a><code><span><span class="keyword">val</span> eval_unop : <span><a href="../../../spoc/Sarek_ir_types/index.html#type-unop">Sarek_ir_types.unop</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-value">value</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-value">value</a></span></code></div></div><h2 id="intrinsics"><a href="#intrinsics" class="anchor"></a>Intrinsics</h2><div class="odoc-spec"><div class="spec value anchored" id="val-is_gpu_path"><a href="#val-is_gpu_path" class="anchor"></a><code><span><span class="keyword">val</span> is_gpu_path : <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_float32_path"><a href="#val-is_float32_path" class="anchor"></a><code><span><span class="keyword">val</span> is_float32_path : <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_float64_path"><a href="#val-is_float64_path" class="anchor"></a><code><span><span class="keyword">val</span> is_float64_path : <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_int32_path"><a href="#val-is_int32_path" class="anchor"></a><code><span><span class="keyword">val</span> is_int32_path : <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><h2 id="intrinsic-evaluation-helpers"><a href="#intrinsic-evaluation-helpers" class="anchor"></a>Intrinsic Evaluation Helpers</h2><p>These helper functions handle specific categories of GPU intrinsics. Split from a monolithic eval_intrinsic for better maintainability and testability. Each helper returns Option to enable clean dispatch logic.</p><p>Evaluate GPU thread/block/grid index and dimension intrinsics.</p><p>Handles the complete GPU execution model intrinsics:</p><ul><li>Thread indices: Position of thread within its block (0 to block_dim-1)</li><li>Block indices: Position of block within grid (0 to grid_dim-1)</li><li>Dimensions: Size of blocks and grid</li><li>Global indices: Thread's global position across entire grid</li><li>Global sizes: Total number of threads in each dimension</li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">state</span> <p>Thread execution state containing all index/dimension values</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">name</span> <p>Intrinsic name (e.g. &quot;thread_idx_x&quot;, &quot;global_size_y&quot;)</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>Some value if intrinsic matches, None otherwise</p></li></ul><p>Example: eval_gpu_index_intrinsic state &quot;global_idx_x&quot; (* Returns: VInt32 (block_idx_x * block_dim_x + thread_idx_x) *)</p><div class="odoc-spec"><div class="spec value anchored" id="val-eval_gpu_index_intrinsic"><a href="#val-eval_gpu_index_intrinsic" class="anchor"></a><code><span><span class="keyword">val</span> eval_gpu_index_intrinsic : <span><a href="#type-thread_state">thread_state</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-value">value</a> option</span></span></code></div><div class="spec-doc"><p>GPU thread/block/grid indices and dimensions</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-eval_barrier_intrinsic"><a href="#val-eval_barrier_intrinsic" class="anchor"></a><code><span><span class="keyword">val</span> eval_barrier_intrinsic : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-value">value</a> option</span></span></code></div><div class="spec-doc"><p>Barrier synchronization intrinsics</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-eval_float32_math_intrinsic"><a href="#val-eval_float32_math_intrinsic" class="anchor"></a><code><span><span class="keyword">val</span> eval_float32_math_intrinsic : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-value">value</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-value">value</a> option</span></span></code></div><div class="spec-doc"><p>Float32 math intrinsics</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-eval_float64_math_intrinsic"><a href="#val-eval_float64_math_intrinsic" class="anchor"></a><code><span><span class="keyword">val</span> eval_float64_math_intrinsic : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-value">value</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-value">value</a> option</span></span></code></div><div class="spec-doc"><p>Float64 math intrinsics</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-eval_int32_math_intrinsic"><a href="#val-eval_int32_math_intrinsic" class="anchor"></a><code><span><span class="keyword">val</span> eval_int32_math_intrinsic : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-value">value</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-value">value</a> option</span></span></code></div><div class="spec-doc"><p>Int32 math intrinsics</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-eval_type_conversion_intrinsic"><a href="#val-eval_type_conversion_intrinsic" class="anchor"></a><code><span><span class="keyword">val</span> eval_type_conversion_intrinsic : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-value">value</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-value">value</a> option</span></span></code></div><div class="spec-doc"><p>Type conversion intrinsics</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-eval_intrinsic"><a href="#val-eval_intrinsic" class="anchor"></a><code><span><span class="keyword">val</span> eval_intrinsic : 
  <span><a href="#type-thread_state">thread_state</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-value">value</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-value">value</a></span></code></div><div class="spec-doc"><p>Main intrinsic dispatcher - tries each category in order</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-eval_intrinsic_by_type"><a href="#val-eval_intrinsic_by_type" class="anchor"></a><code><span><span class="keyword">val</span> eval_intrinsic_by_type : <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-value">value</a> list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-value">value</a></span></code></div><div class="spec-doc"><p>Try type-specific intrinsics based on path</p></div></div><h2 id="expression-evaluation"><a href="#expression-evaluation" class="anchor"></a>Expression Evaluation</h2><div class="odoc-spec"><div class="spec value anchored" id="val-eval_array_expr"><a href="#val-eval_array_expr" class="anchor"></a><code><span><span class="keyword">val</span> eval_array_expr : <span><a href="#type-thread_state">thread_state</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../spoc/Sarek_ir_types/index.html#type-expr">Sarek_ir_types.expr</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-value">value</a></span></code></div><div class="spec-doc"><p>Array expression evaluation</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-eval_composite_expr"><a href="#val-eval_composite_expr" class="anchor"></a><code><span><span class="keyword">val</span> eval_composite_expr : 
  <span><a href="#type-thread_state">thread_state</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../spoc/Sarek_ir_types/index.html#type-expr">Sarek_ir_types.expr</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../Sarek_value/index.html#type-value">Sarek_value.value</a></span></code></div><div class="spec-doc"><p>Record and variant expression evaluation</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-eval_control_flow"><a href="#val-eval_control_flow" class="anchor"></a><code><span><span class="keyword">val</span> eval_control_flow : <span><a href="#type-thread_state">thread_state</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../spoc/Sarek_ir_types/index.html#type-expr">Sarek_ir_types.expr</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-value">value</a></span></code></div><div class="spec-doc"><p>Control flow expression evaluation</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-eval_special_expr"><a href="#val-eval_special_expr" class="anchor"></a><code><span><span class="keyword">val</span> eval_special_expr : <span><a href="#type-thread_state">thread_state</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../spoc/Sarek_ir_types/index.html#type-expr">Sarek_ir_types.expr</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-value">value</a></span></code></div><div class="spec-doc"><p>Cast and intrinsic expression evaluation</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-eval_expr"><a href="#val-eval_expr" class="anchor"></a><code><span><span class="keyword">val</span> eval_expr : <span><a href="#type-thread_state">thread_state</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../spoc/Sarek_ir_types/index.html#type-expr">Sarek_ir_types.expr</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-value">value</a></span></code></div><div class="spec-doc"><p>Main expression evaluator - dispatches to specialized handlers</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_array"><a href="#val-get_array" class="anchor"></a><code><span><span class="keyword">val</span> get_array : <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-value">value</a> array</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-eval_app"><a href="#val-eval_app" class="anchor"></a><code><span><span class="keyword">val</span> eval_app : 
  <span><a href="#type-thread_state">thread_state</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../spoc/Sarek_ir_types/index.html#type-expr">Sarek_ir_types.expr</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../spoc/Sarek_ir_types/index.html#type-expr">Sarek_ir_types.expr</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-value">value</a></span></code></div></div><h2 id="statement-execution"><a href="#statement-execution" class="anchor"></a>Statement Execution</h2><div class="odoc-spec"><div class="spec value anchored" id="val-exec_stmt"><a href="#val-exec_stmt" class="anchor"></a><code><span><span class="keyword">val</span> exec_stmt : <span><a href="#type-thread_state">thread_state</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../spoc/Sarek_ir_types/index.html#type-stmt">Sarek_ir_types.stmt</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-assign_lvalue"><a href="#val-assign_lvalue" class="anchor"></a><code><span><span class="keyword">val</span> assign_lvalue : 
  <span><a href="#type-thread_state">thread_state</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../spoc/Sarek_ir_types/index.html#type-lvalue">Sarek_ir_types.lvalue</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-value">value</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-exec_stmt_for_return"><a href="#val-exec_stmt_for_return" class="anchor"></a><code><span><span class="keyword">val</span> exec_stmt_for_return : <span><a href="#type-thread_state">thread_state</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../spoc/Sarek_ir_types/index.html#type-stmt">Sarek_ir_types.stmt</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-value">value</a></span></code></div></div><h2 id="kernel-execution"><a href="#kernel-execution" class="anchor"></a>Kernel Execution</h2><div class="odoc-spec"><div class="spec value anchored" id="val-run_block"><a href="#val-run_block" class="anchor"></a><code><span><span class="keyword">val</span> run_block : 
  <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../spoc/Sarek_ir_types/index.html#type-stmt">Sarek_ir_types.stmt</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(int * int * int)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(int * int * int)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(int * int * int)</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Run all threads in a block with BSP barrier synchronization</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run_grid_sequential"><a href="#val-run_grid_sequential" class="anchor"></a><code><span><span class="keyword">val</span> run_grid_sequential : 
  <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../spoc/Sarek_ir_types/index.html#type-stmt">Sarek_ir_types.stmt</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(int * int * int)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(int * int * int)</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Run all blocks in a grid (sequential)</p></div></div><h2 id="domain-pool-for-parallel-execution"><a href="#domain-pool-for-parallel-execution" class="anchor"></a>Domain Pool for Parallel Execution</h2><div class="odoc-spec"><div class="spec module anchored" id="module-DomainPool"><a href="#module-DomainPool" class="anchor"></a><code><span><span class="keyword">module</span> <a href="DomainPool/index.html">DomainPool</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-global_pool"><a href="#val-global_pool" class="anchor"></a><code><span><span class="keyword">val</span> global_pool : <span><span><a href="DomainPool/index.html#type-t">DomainPool.t</a> option</span> <span class="xref-unresolved">Stdlib</span>.ref</span></span></code></div><div class="spec-doc"><p>Global pool - lazily initialized</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_pool"><a href="#val-get_pool" class="anchor"></a><code><span><span class="keyword">val</span> get_pool : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="DomainPool/index.html#type-t">DomainPool.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run_grid_parallel"><a href="#val-run_grid_parallel" class="anchor"></a><code><span><span class="keyword">val</span> run_grid_parallel : 
  <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../spoc/Sarek_ir_types/index.html#type-stmt">Sarek_ir_types.stmt</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(int * int * int)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(int * int * int)</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Run all blocks in a grid (parallel - distributes blocks across domain pool)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-parallel_mode"><a href="#val-parallel_mode" class="anchor"></a><code><span><span class="keyword">val</span> parallel_mode : <span>bool <span class="xref-unresolved">Stdlib</span>.ref</span></span></code></div><div class="spec-doc"><p>Parallel execution mode flag</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run_grid"><a href="#val-run_grid" class="anchor"></a><code><span><span class="keyword">val</span> run_grid : 
  <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../spoc/Sarek_ir_types/index.html#type-stmt">Sarek_ir_types.stmt</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(int * int * int)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(int * int * int)</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Run all blocks in a grid (uses parallel or sequential based on flag)</p></div></div><h2 id="public-api"><a href="#public-api" class="anchor"></a>Public API</h2><div class="odoc-spec"><div class="spec type anchored" id="type-arg"><a href="#type-arg" class="anchor"></a><code><span><span class="keyword">type</span> arg</span><span> = </span></code><ol><li id="type-arg.ArgArray" class="def variant constructor anchored"><a href="#type-arg.ArgArray" class="anchor"></a><code><span>| </span><span><span class="constructor">ArgArray</span> <span class="keyword">of</span> <span><a href="#type-value">value</a> array</span></span></code></li><li id="type-arg.ArgScalar" class="def variant constructor anchored"><a href="#type-arg.ArgScalar" class="anchor"></a><code><span>| </span><span><span class="constructor">ArgScalar</span> <span class="keyword">of</span> <a href="#type-value">value</a></span></code></li></ol></div><div class="spec-doc"><p>Argument for kernel execution</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run_kernel"><a href="#val-run_kernel" class="anchor"></a><code><span><span class="keyword">val</span> run_kernel : 
  <span><a href="../../../spoc/Sarek_ir_types/index.html#type-kernel">Sarek_ir_types.kernel</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">block</span>:<span>(int * int * int)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">grid</span>:<span>(int * int * int)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(string * <a href="#type-arg">arg</a>)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Run a kernel on CPU</p></div></div><h2 id="v2-vector-support"><a href="#v2-vector-support" class="anchor"></a>V2 Vector Support</h2><p>These functions work with typed Kernel_arg.t values instead of Obj.t. This is the preferred interface for Native/Interpreter backends.</p><div class="odoc-spec"><div class="spec value anchored" id="val-vector_to_array"><a href="#val-vector_to_array" class="anchor"></a><code><span><span class="keyword">val</span> vector_to_array : 'a 'b. <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../../Spoc_core/Vector/index.html#type-t">Spoc_core.Vector.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-value">value</a> array</span></span></code></div><div class="spec-doc"><p>Convert V2 Vector to interpreter value array. Uses the vector's element type to create properly typed values.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-array_to_vector"><a href="#val-array_to_vector" class="anchor"></a><code><span><span class="keyword">val</span> array_to_vector : 'a 'b. <span><span><a href="#type-value">value</a> array</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../../Spoc_core/Vector/index.html#type-t">Spoc_core.Vector.t</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Write interpreter value array back to V2 Vector</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-writeback"><a href="#type-writeback" class="anchor"></a><code><span><span class="keyword">type</span> writeback</span><span> = </span></code><ol><li id="type-writeback.Writeback" class="def variant constructor anchored"><a href="#type-writeback.Writeback" class="anchor"></a><code><span>| </span><span><span class="constructor">Writeback</span> : <span>(<span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../../Spoc_core/Vector/index.html#type-t">Spoc_core.Vector.t</a></span> * <span><a href="#type-value">value</a> array</span>)</span> <span class="arrow">&#45;&gt;</span> <a href="#type-writeback">writeback</a></span></code></li></ol></div><div class="spec-doc"><p>Existential wrapper to track V2 Vector + its interpreter array for writeback</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-args_from_kernel_args"><a href="#val-args_from_kernel_args" class="anchor"></a><code><span><span class="keyword">val</span> args_from_kernel_args : 
  <span><a href="../../../spoc/Sarek_ir_types/index.html#type-kernel">Sarek_ir_types.kernel</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../Spoc_core/Kernel_arg/index.html#type-t">Spoc_core.Kernel_arg.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(string * <a href="#type-arg">arg</a>)</span> list</span> * <span><a href="#type-writeback">writeback</a> list</span></span></code></div><div class="spec-doc"><p>Convert Kernel_arg.t list to interpreter args, tracking vectors for writeback</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run_kernel_with_args"><a href="#val-run_kernel_with_args" class="anchor"></a><code><span><span class="keyword">val</span> run_kernel_with_args : 
  <span><a href="../../../spoc/Sarek_ir_types/index.html#type-kernel">Sarek_ir_types.kernel</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">block</span>:<span>(int * int * int)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">grid</span>:<span>(int * int * int)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../Spoc_core/Kernel_arg/index.html#type-t">Spoc_core.Kernel_arg.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Run kernel with V2 Vector arguments (Kernel_arg.t list). This is the preferred entry point for Native/Interpreter backends. Handles conversion to/from interpreter format with proper writeback.</p></div></div></div></body></html>
