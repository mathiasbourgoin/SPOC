<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Backend (sarek-cuda.Sarek_cuda.Cuda_plugin.Backend)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../../index.html">Index</a> &#x00BB; <a href="../../../index.html">sarek-cuda</a> &#x00BB; <a href="../../index.html">Sarek_cuda</a> &#x00BB; <a href="../index.html">Cuda_plugin</a> &#x00BB; Backend</nav><header class="odoc-preamble"><h1>Module <code><span>Cuda_plugin.Backend</span></code></h1><p>CUDA Backend - implements BACKEND</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#external-kernel-execution">External Kernel Execution</a></li><li><a href="#kernel-args-wrapping">Kernel Args Wrapping</a></li></ul></nav></div><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-name"><a href="#val-name" class="anchor"></a><code><span><span class="keyword">val</span> name : string</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-version"><a href="#val-version" class="anchor"></a><code><span><span class="keyword">val</span> version : int * int * int</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_available"><a href="#val-is_available" class="anchor"></a><code><span><span class="keyword">val</span> is_available : <span>unit <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Device"><a href="#module-Device" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Device/index.html">Device</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Device management</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Stream"><a href="#module-Stream" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Stream/index.html">Stream</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Async execution streams / command queues</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Memory"><a href="#module-Memory" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Memory/index.html">Memory</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>GPU memory allocation and transfer</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Event"><a href="#module-Event" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Event/index.html">Event</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Timing events</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Kernel"><a href="#module-Kernel" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Kernel/index.html">Kernel</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Kernel compilation and execution</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-enable_profiling"><a href="#val-enable_profiling" class="anchor"></a><code><span><span class="keyword">val</span> enable_profiling : <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-disable_profiling"><a href="#val-disable_profiling" class="anchor"></a><code><span><span class="keyword">val</span> disable_profiling : <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-execution_model"><a href="#val-execution_model" class="anchor"></a><code><span><span class="keyword">val</span> execution_model : <a href="../../../../spoc/Spoc_framework/Framework_sig/index.html#type-execution_model">Spoc_framework.Framework_sig.execution_model</a></span></code></div><div class="spec-doc"><p>The execution model this backend uses</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-generate_source"><a href="#val-generate_source" class="anchor"></a><code><span><span class="keyword">val</span> generate_source : 
  <span><span class="optlabel">?block</span>:<a href="../../../../spoc/Spoc_framework/Framework_sig/index.html#type-dims">Spoc_framework.Framework_sig.dims</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../../spoc/Sarek_ir_types/index.html#type-kernel">Sarek_ir_types.kernel</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string option</span></span></code></div><div class="spec-doc"><p>Generate source code from Sarek IR (for JIT backends). Returns None for Direct/Custom backends.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">block</span> <p>Optional block dimensions (required for Vulkan/GLSL which embeds workgroup size in shader)</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-execute_direct"><a href="#val-execute_direct" class="anchor"></a><code><span><span class="keyword">val</span> execute_direct : 
  <span><span class="label">native_fn</span>:
    <span><span>(<span><span class="label">block</span>:<a href="../../../../spoc/Spoc_framework/Framework_sig/index.html#type-dims">Spoc_framework.Framework_sig.dims</a> <span class="arrow">&#45;&gt;</span></span>
      <span><span class="label">grid</span>:<a href="../../../../spoc/Spoc_framework/Framework_sig/index.html#type-dims">Spoc_framework.Framework_sig.dims</a> <span class="arrow">&#45;&gt;</span></span>
      <span><span><a href="../../../../spoc/Spoc_framework/Framework_sig/index.html#type-exec_arg">Spoc_framework.Framework_sig.exec_arg</a> array</span> <span class="arrow">&#45;&gt;</span></span>
      unit)</span>
      option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">ir</span>:<span><a href="../../../../spoc/Sarek_ir_types/index.html#type-kernel">Sarek_ir_types.kernel</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">block</span>:<a href="../../../../spoc/Spoc_framework/Framework_sig/index.html#type-dims">Spoc_framework.Framework_sig.dims</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">grid</span>:<a href="../../../../spoc/Spoc_framework/Framework_sig/index.html#type-dims">Spoc_framework.Framework_sig.dims</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../../spoc/Spoc_framework/Framework_sig/index.html#type-exec_arg">Spoc_framework.Framework_sig.exec_arg</a> array</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Execute a kernel directly (for Direct/Custom backends). JIT backends should raise an error if this is called. The backend chooses which component to use:</p><ul><li>Direct backends (Native): use native_fn</li><li>Custom backends (Interpreter): use ir</li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">native_fn</span> <p>Pre-compiled OCaml function (from PPX)</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">ir</span> <p>Sarek IR kernel (for interpretation)</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">block</span> <p>Block dimensions</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">grid</span> <p>Grid dimensions</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">args</span> <p>Kernel arguments - fully typed, no Obj.t</p></li></ul></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Intrinsics"><a href="#module-Intrinsics" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Intrinsics/index.html">Intrinsics</a></span><span> : <a href="../../../../spoc/Spoc_framework/Framework_sig/module-type-INTRINSIC_REGISTRY/index.html">Spoc_framework.Framework_sig.INTRINSIC_REGISTRY</a></span></code></div><div class="spec-doc"><p>Backend-specific intrinsic registry</p></div></div><h3 id="external-kernel-execution"><a href="#external-kernel-execution" class="anchor"></a>External Kernel Execution</h3><div class="odoc-spec"><div class="spec value anchored" id="val-supported_source_langs"><a href="#val-supported_source_langs" class="anchor"></a><code><span><span class="keyword">val</span> supported_source_langs : <span><a href="../../../../spoc/Spoc_framework/Framework_sig/index.html#type-source_lang">Spoc_framework.Framework_sig.source_lang</a> list</span></span></code></div><div class="spec-doc"><p>List of source languages this backend supports</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run_source"><a href="#val-run_source" class="anchor"></a><code><span><span class="keyword">val</span> run_source : 
  <span><span class="label">source</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">lang</span>:<a href="../../../../spoc/Spoc_framework/Framework_sig/index.html#type-source_lang">Spoc_framework.Framework_sig.source_lang</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">kernel_name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">block</span>:<a href="../../../../spoc/Spoc_framework/Framework_sig/index.html#type-dims">Spoc_framework.Framework_sig.dims</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">grid</span>:<a href="../../../../spoc/Spoc_framework/Framework_sig/index.html#type-dims">Spoc_framework.Framework_sig.dims</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">shared_mem</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../../spoc/Spoc_framework/Framework_sig/index.html#type-run_source_arg">Spoc_framework.Framework_sig.run_source_arg</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Execute an external kernel from source code.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">source</span> <p>The kernel source code (CUDA/OpenCL/PTX string)</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">lang</span> <p>The source language</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">kernel_name</span> <p>The name of the kernel function to execute</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">block</span> <p>Block dimensions</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">grid</span> <p>Grid dimensions</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">shared_mem</span> <p>Shared memory size in bytes</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">args</span> <p>Kernel arguments as run_source_arg list</p></li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Failure</code> <p>if source language is not supported</p></li></ul></div></div><h3 id="kernel-args-wrapping"><a href="#kernel-args-wrapping" class="anchor"></a>Kernel Args Wrapping</h3><p>Type-safe wrapping/unwrapping of backend-specific kernel args into the extensible kargs type. Each backend extends kargs with its own variant.</p><div class="odoc-spec"><div class="spec value anchored" id="val-wrap_kargs"><a href="#val-wrap_kargs" class="anchor"></a><code><span><span class="keyword">val</span> wrap_kargs : <span><a href="Kernel/index.html#type-args">Kernel.args</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../../spoc/Spoc_framework/Framework_sig/index.html#type-kargs">Spoc_framework.Framework_sig.kargs</a></span></code></div><div class="spec-doc"><p>Wrap this backend's kernel args into a kargs variant</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-unwrap_kargs"><a href="#val-unwrap_kargs" class="anchor"></a><code><span><span class="keyword">val</span> unwrap_kargs : <span><a href="../../../../spoc/Spoc_framework/Framework_sig/index.html#type-kargs">Spoc_framework.Framework_sig.kargs</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Kernel/index.html#type-args">Kernel.args</a> option</span></span></code></div><div class="spec-doc"><p>Unwrap kargs to this backend's kernel args. Returns None if wrong backend.</p></div></div></div></body></html>
