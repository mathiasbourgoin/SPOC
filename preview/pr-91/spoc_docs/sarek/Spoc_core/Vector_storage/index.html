<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Vector_storage (sarek.Spoc_core.Vector_storage)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">sarek</a> &#x00BB; <a href="../index.html">Spoc_core</a> &#x00BB; Vector_storage</nav><header class="odoc-preamble"><h1>Module <code><span>Spoc_core.Vector_storage</span></code></h1></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#creation">Creation</a></li><li><a href="#creation-from-existing-data">Creation from Existing Data</a></li><li><a href="#accessors">Accessors</a></li><li><a href="#device-buffer-bookkeeping">Device buffer bookkeeping</a></li><li><a href="#subvector-metadata">Subvector Metadata</a></li><li><a href="#copy-&amp;-slicing">Copy &amp; Slicing</a></li></ul></nav></div><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-next_id"><a href="#val-next_id" class="anchor"></a><code><span><span class="keyword">val</span> next_id : <span>int <span class="xref-unresolved">Stdlib</span>.ref</span></span></code></div><div class="spec-doc"><p>Global vector ID counter</p></div></div><h2 id="creation"><a href="#creation" class="anchor"></a>Creation</h2><div class="odoc-spec"><div class="spec value anchored" id="val-create_scalar"><a href="#val-create_scalar" class="anchor"></a><code><span><span class="keyword">val</span> create_scalar : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-scalar_kind">Vector_types.scalar_kind</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?dev</span>:<a href="../Device/index.html#type-t">Device.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span></span></code></div><div class="spec-doc"><p>Create a new scalar vector on CPU</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : 
  'a 'b. <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-kind">Vector_types.kind</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?dev</span>:<a href="../Device/index.html#type-t">Device.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span></span></code></div><div class="spec-doc"><p>Create from kind (allocates storage for custom types too)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_custom"><a href="#val-create_custom" class="anchor"></a><code><span><span class="keyword">val</span> create_custom : 
  <span><span><span class="type-var">'a</span> <a href="../Vector_types/index.html#type-custom_type">Vector_types.custom_type</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?dev</span>:<a href="../Device/index.html#type-t">Device.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, unit)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span></span></code></div><div class="spec-doc"><p>Create a custom vector with explicit type descriptor</p></div></div><h2 id="creation-from-existing-data"><a href="#creation-from-existing-data" class="anchor"></a>Creation from Existing Data</h2><div class="odoc-spec"><div class="spec value anchored" id="val-of_bigarray"><a href="#val-of_bigarray" class="anchor"></a><code><span><span class="keyword">val</span> of_bigarray : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-scalar_kind">Vector_types.scalar_kind</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="xref-unresolved">Stdlib</span>.Bigarray.c_layout)</span> <span class="xref-unresolved">Stdlib</span>.Bigarray.Array1.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span></span></code></div><div class="spec-doc"><p>Create from existing Bigarray (shares memory)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-of_ctypes_ptr"><a href="#val-of_ctypes_ptr" class="anchor"></a><code><span><span class="keyword">val</span> of_ctypes_ptr : 
  <span><span><span class="type-var">'a</span> <a href="../Vector_types/index.html#type-custom_type">Vector_types.custom_type</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <span class="xref-unresolved">Ctypes</span>.ptr</span> <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, unit)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span></span></code></div><div class="spec-doc"><p>Create from existing ctypes pointer (shares memory)</p></div></div><h2 id="accessors"><a href="#accessors" class="anchor"></a>Accessors</h2><div class="odoc-spec"><div class="spec value anchored" id="val-to_bigarray"><a href="#val-to_bigarray" class="anchor"></a><code><span><span class="keyword">val</span> to_bigarray : 
  'a 'b. <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="xref-unresolved">Stdlib</span>.Bigarray.c_layout)</span> <span class="xref-unresolved">Stdlib</span>.Bigarray.Array1.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-of_list"><a href="#val-of_list" class="anchor"></a><code><span><span class="keyword">val</span> of_list : 
  'a 'b. <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-kind">Vector_types.kind</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span></span></code></div><div class="spec-doc"><p>Create from OCaml list</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-of_array"><a href="#val-of_array" class="anchor"></a><code><span><span class="keyword">val</span> of_array : 
  'a 'b. <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-kind">Vector_types.kind</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> array</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span></span></code></div><div class="spec-doc"><p>Create from OCaml array</p></div></div><h2 id="device-buffer-bookkeeping"><a href="#device-buffer-bookkeeping" class="anchor"></a>Device buffer bookkeeping</h2><div class="odoc-spec"><div class="spec value anchored" id="val-has_buffer"><a href="#val-has_buffer" class="anchor"></a><code><span><span class="keyword">val</span> has_buffer : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Device/index.html#type-t">Device.t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Check if vector has buffer on specific device</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_buffer"><a href="#val-get_buffer" class="anchor"></a><code><span><span class="keyword">val</span> get_buffer : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Device/index.html#type-t">Device.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Vector_types/index.html#type-device_buffer">Vector_types.device_buffer</a> option</span></span></code></div><div class="spec-doc"><p>Get device buffer if allocated</p></div></div><h2 id="subvector-metadata"><a href="#subvector-metadata" class="anchor"></a>Subvector Metadata</h2><div class="odoc-spec"><div class="spec type anchored" id="type-sub_meta"><a href="#type-sub_meta" class="anchor"></a><code><span><span class="keyword">type</span> sub_meta</span><span> = </span><span>{</span></code><ol><li id="type-sub_meta.parent_id" class="def record field anchored"><a href="#type-sub_meta.parent_id" class="anchor"></a><code><span>parent_id : int;</span></code></li><li id="type-sub_meta.start" class="def record field anchored"><a href="#type-sub_meta.start" class="anchor"></a><code><span>start : int;</span></code></li><li id="type-sub_meta.ok_range" class="def record field anchored"><a href="#type-sub_meta.ok_range" class="anchor"></a><code><span>ok_range : int;</span></code></li><li id="type-sub_meta.ko_range" class="def record field anchored"><a href="#type-sub_meta.ko_range" class="anchor"></a><code><span>ko_range : int;</span></code></li><li id="type-sub_meta.depth" class="def record field anchored"><a href="#type-sub_meta.depth" class="anchor"></a><code><span>depth : int;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-subvector_meta"><a href="#val-subvector_meta" class="anchor"></a><code><span><span class="keyword">val</span> subvector_meta : <span><span>(int, <a href="#type-sub_meta">sub_meta</a>)</span> <span class="xref-unresolved">Stdlib</span>.Hashtbl.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_sub"><a href="#val-is_sub" class="anchor"></a><code><span><span class="keyword">val</span> is_sub : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_sub_meta"><a href="#val-get_sub_meta" class="anchor"></a><code><span><span class="keyword">val</span> get_sub_meta : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-sub_meta">sub_meta</a> option</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-depth"><a href="#val-depth" class="anchor"></a><code><span><span class="keyword">val</span> depth : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-parent_id"><a href="#val-parent_id" class="anchor"></a><code><span><span class="keyword">val</span> parent_id : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int option</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sub_start"><a href="#val-sub_start" class="anchor"></a><code><span><span class="keyword">val</span> sub_start : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int option</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sub_ok_range"><a href="#val-sub_ok_range" class="anchor"></a><code><span><span class="keyword">val</span> sub_ok_range : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int option</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sub_ko_range"><a href="#val-sub_ko_range" class="anchor"></a><code><span><span class="keyword">val</span> sub_ko_range : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int option</span></span></code></div></div><h2 id="copy-&amp;-slicing"><a href="#copy-&amp;-slicing" class="anchor"></a>Copy &amp; Slicing</h2><div class="odoc-spec"><div class="spec value anchored" id="val-copy_host_only"><a href="#val-copy_host_only" class="anchor"></a><code><span><span class="keyword">val</span> copy_host_only : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span></span></code></div><div class="spec-doc"><p>Copy vector (CPU data only). Caller must ensure sync if needed.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sub_vector_host"><a href="#val-sub_vector_host" class="anchor"></a><code><span><span class="keyword">val</span> sub_vector_host : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">start</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">len</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span></span></code></div><div class="spec-doc"><p>Create subvector that views the same host storage with an offset</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sub_vector"><a href="#val-sub_vector" class="anchor"></a><code><span><span class="keyword">val</span> sub_vector : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">start</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">len</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">ok_range</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">ko_range</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span></span></code></div><div class="spec-doc"><p>Create subvector and record metadata</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-partition_host"><a href="#val-partition_host" class="anchor"></a><code><span><span class="keyword">val</span> partition_host : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Device/index.html#type-t">Device.t</a> array</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Vector_types/index.html#type-t">Vector_types.t</a></span> array</span></span></code></div><div class="spec-doc"><p>Partition host storage evenly across devices (no device buffers)</p></div></div></div></body></html>
