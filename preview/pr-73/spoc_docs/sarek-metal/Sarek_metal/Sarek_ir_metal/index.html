<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Sarek_ir_metal (sarek-metal.Sarek_metal.Sarek_ir_metal)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">sarek-metal</a> &#x00BB; <a href="../index.html">Sarek_metal</a> &#x00BB; Sarek_ir_metal</nav><header class="odoc-preamble"><h1>Module <code><span>Sarek_metal.Sarek_ir_metal</span></code></h1></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#type-mapping">Type Mapping</a></li><li><a href="#thread-intrinsics">Thread Intrinsics</a></li><li><a href="#expression-generation">Expression Generation</a></li><li><a href="#l-value-generation">L-value Generation</a></li><li><a href="#statement-generation">Statement Generation</a></li><li><a href="#declaration-generation">Declaration Generation</a></li><li><a href="#helper-function-generation">Helper Function Generation</a></li><li><a href="#kernel-generation">Kernel Generation</a></li></ul></nav></div><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-current_device"><a href="#val-current_device" class="anchor"></a><code><span><span class="keyword">val</span> current_device : <span><span><a href="../../../sarek/Spoc_core/Device/index.html#type-t">Spoc_core.Device.t</a> option</span> <span class="xref-unresolved">Stdlib</span>.ref</span></span></code></div><div class="spec-doc"><p>Current device for SNative code generation (set during generate_for_device)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-current_variants"><a href="#val-current_variants" class="anchor"></a><code><span><span class="keyword">val</span> current_variants : 
  <span><span><span>(string * <span><span>(string * <span><a href="../../../spoc/Sarek_ir_types/index.html#type-elttype">Sarek_ir_types.elttype</a> list</span>)</span> list</span>)</span> list</span> <span class="xref-unresolved">Stdlib</span>.ref</span></span></code></div><div class="spec-doc"><p>Current kernel's variant definitions (set during generate)</p></div></div><h2 id="type-mapping"><a href="#type-mapping" class="anchor"></a>Type Mapping</h2><div class="odoc-spec"><div class="spec value anchored" id="val-mangle_name"><a href="#val-mangle_name" class="anchor"></a><code><span><span class="keyword">val</span> mangle_name : <span>string <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Mangle OCaml type name to valid C identifier (e.g., &quot;Module.point&quot; -&gt; &quot;Module_point&quot;)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-metal_type_of_elttype"><a href="#val-metal_type_of_elttype" class="anchor"></a><code><span><span class="keyword">val</span> metal_type_of_elttype : <span><a href="../../../spoc/Sarek_ir_types/index.html#type-elttype">Sarek_ir_types.elttype</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Map Sarek IR element type to Metal C type string</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-metal_memspace"><a href="#val-metal_memspace" class="anchor"></a><code><span><span class="keyword">val</span> metal_memspace : <span><a href="../../../spoc/Sarek_ir_types/index.html#type-memspace">Sarek_ir_types.memspace</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Map memory space to Metal qualifier</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-metal_param_type"><a href="#val-metal_param_type" class="anchor"></a><code><span><span class="keyword">val</span> metal_param_type : <span><a href="../../../spoc/Sarek_ir_types/index.html#type-elttype">Sarek_ir_types.elttype</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Map Sarek IR element type to Metal C type for kernel parameters</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-metal_helper_param_type"><a href="#val-metal_helper_param_type" class="anchor"></a><code><span><span class="keyword">val</span> metal_helper_param_type : <span><a href="../../../spoc/Sarek_ir_types/index.html#type-elttype">Sarek_ir_types.elttype</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Map Sarek IR element type to Metal C type for helper function parameters</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-metal_atomic_type_of_elttype"><a href="#val-metal_atomic_type_of_elttype" class="anchor"></a><code><span><span class="keyword">val</span> metal_atomic_type_of_elttype : <span><a href="../../../spoc/Sarek_ir_types/index.html#type-elttype">Sarek_ir_types.elttype</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Convert type to atomic type for Metal</p></div></div><h2 id="thread-intrinsics"><a href="#thread-intrinsics" class="anchor"></a>Thread Intrinsics</h2><div class="odoc-spec"><div class="spec value anchored" id="val-metal_thread_intrinsic"><a href="#val-metal_thread_intrinsic" class="anchor"></a><code><span><span class="keyword">val</span> metal_thread_intrinsic : <span>string <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><h2 id="expression-generation"><a href="#expression-generation" class="anchor"></a>Expression Generation</h2><div class="odoc-spec"><div class="spec value anchored" id="val-gen_expr"><a href="#val-gen_expr" class="anchor"></a><code><span><span class="keyword">val</span> gen_expr : <span><span class="xref-unresolved">Stdlib</span>.Buffer.t <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../spoc/Sarek_ir_types/index.html#type-expr">Sarek_ir_types.expr</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gen_binop"><a href="#val-gen_binop" class="anchor"></a><code><span><span class="keyword">val</span> gen_binop : <span><a href="../../../spoc/Sarek_ir_types/index.html#type-binop">Sarek_ir_types.binop</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gen_unop"><a href="#val-gen_unop" class="anchor"></a><code><span><span class="keyword">val</span> gen_unop : <span><a href="../../../spoc/Sarek_ir_types/index.html#type-unop">Sarek_ir_types.unop</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gen_intrinsic"><a href="#val-gen_intrinsic" class="anchor"></a><code><span><span class="keyword">val</span> gen_intrinsic : 
  <span><span class="xref-unresolved">Stdlib</span>.Buffer.t <span class="arrow">&#45;&gt;</span></span>
  <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../spoc/Sarek_ir_types/index.html#type-expr">Sarek_ir_types.expr</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><h2 id="l-value-generation"><a href="#l-value-generation" class="anchor"></a>L-value Generation</h2><div class="odoc-spec"><div class="spec value anchored" id="val-gen_lvalue"><a href="#val-gen_lvalue" class="anchor"></a><code><span><span class="keyword">val</span> gen_lvalue : <span><span class="xref-unresolved">Stdlib</span>.Buffer.t <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../spoc/Sarek_ir_types/index.html#type-lvalue">Sarek_ir_types.lvalue</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><h2 id="statement-generation"><a href="#statement-generation" class="anchor"></a>Statement Generation</h2><div class="odoc-spec"><div class="spec value anchored" id="val-indent_nested"><a href="#val-indent_nested" class="anchor"></a><code><span><span class="keyword">val</span> indent_nested : <span>string <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Nested indentation level</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gen_match_pattern"><a href="#val-gen_match_pattern" class="anchor"></a><code><span><span class="keyword">val</span> gen_match_pattern : 
  <span><span class="xref-unresolved">Stdlib</span>.Buffer.t <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>string <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../../../spoc/Sarek_ir_types/index.html#type-elttype">Sarek_ir_types.elttype</a> list</span> option</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Generate match case pattern with variable bindings</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gen_var_decl"><a href="#val-gen_var_decl" class="anchor"></a><code><span><span class="keyword">val</span> gen_var_decl : 
  <span><span class="xref-unresolved">Stdlib</span>.Buffer.t <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../spoc/Sarek_ir_types/index.html#type-elttype">Sarek_ir_types.elttype</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../spoc/Sarek_ir_types/index.html#type-expr">Sarek_ir_types.expr</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Generate variable declaration with initialization</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gen_array_decl"><a href="#val-gen_array_decl" class="anchor"></a><code><span><span class="keyword">val</span> gen_array_decl : 
  <span><span class="xref-unresolved">Stdlib</span>.Buffer.t <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../spoc/Sarek_ir_types/index.html#type-elttype">Sarek_ir_types.elttype</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../spoc/Sarek_ir_types/index.html#type-expr">Sarek_ir_types.expr</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Generate array declaration</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gen_stmt"><a href="#val-gen_stmt" class="anchor"></a><code><span><span class="keyword">val</span> gen_stmt : <span><span class="xref-unresolved">Stdlib</span>.Buffer.t <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../spoc/Sarek_ir_types/index.html#type-stmt">Sarek_ir_types.stmt</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><h2 id="declaration-generation"><a href="#declaration-generation" class="anchor"></a>Declaration Generation</h2><div class="odoc-spec"><div class="spec value anchored" id="val-is_vec_type"><a href="#val-is_vec_type" class="anchor"></a><code><span><span class="keyword">val</span> is_vec_type : <span><a href="../../../spoc/Sarek_ir_types/index.html#type-elttype">Sarek_ir_types.elttype</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Check if a type is a vector (requires length parameter)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gen_param_metal"><a href="#val-gen_param_metal" class="anchor"></a><code><span><span class="keyword">val</span> gen_param_metal : 
  <span><span class="xref-unresolved">Stdlib</span>.Buffer.t <span class="arrow">&#45;&gt;</span></span>
  <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../spoc/Sarek_ir_types/index.html#type-decl">Sarek_ir_types.decl</a> <span class="arrow">&#45;&gt;</span></span>
  int</span></code></div><div class="spec-doc"><p>Generate parameter with Metal buffer attributes, returns next buffer index</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gen_param"><a href="#val-gen_param" class="anchor"></a><code><span><span class="keyword">val</span> gen_param : <span><span class="xref-unresolved">Stdlib</span>.Buffer.t <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../spoc/Sarek_ir_types/index.html#type-decl">Sarek_ir_types.decl</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-collect_atomic_vars_expr"><a href="#val-collect_atomic_vars_expr" class="anchor"></a><code><span><span class="keyword">val</span> collect_atomic_vars_expr : <span><a href="../../../spoc/Sarek_ir_types/index.html#type-expr">Sarek_ir_types.expr</a> <span class="arrow">&#45;&gt;</span></span> <span>string list</span></span></code></div><div class="spec-doc"><p>Collect variable names used in atomic operations</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-collect_atomic_vars_lvalue"><a href="#val-collect_atomic_vars_lvalue" class="anchor"></a><code><span><span class="keyword">val</span> collect_atomic_vars_lvalue : <span><a href="../../../spoc/Sarek_ir_types/index.html#type-lvalue">Sarek_ir_types.lvalue</a> <span class="arrow">&#45;&gt;</span></span> <span>string list</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-collect_atomic_vars_stmt"><a href="#val-collect_atomic_vars_stmt" class="anchor"></a><code><span><span class="keyword">val</span> collect_atomic_vars_stmt : <span><a href="../../../spoc/Sarek_ir_types/index.html#type-stmt">Sarek_ir_types.stmt</a> <span class="arrow">&#45;&gt;</span></span> <span>string list</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gen_local"><a href="#val-gen_local" class="anchor"></a><code><span><span class="keyword">val</span> gen_local : 
  <span><span class="xref-unresolved">Stdlib</span>.Buffer.t <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../spoc/Sarek_ir_types/index.html#type-decl">Sarek_ir_types.decl</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><h2 id="helper-function-generation"><a href="#helper-function-generation" class="anchor"></a>Helper Function Generation</h2><div class="odoc-spec"><div class="spec value anchored" id="val-gen_helper_func"><a href="#val-gen_helper_func" class="anchor"></a><code><span><span class="keyword">val</span> gen_helper_func : <span><span class="xref-unresolved">Stdlib</span>.Buffer.t <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../spoc/Sarek_ir_types/index.html#type-helper_func">Sarek_ir_types.helper_func</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Generate a helper function (Metal device function)</p></div></div><h2 id="kernel-generation"><a href="#kernel-generation" class="anchor"></a>Kernel Generation</h2><div class="odoc-spec"><div class="spec value anchored" id="val-generate"><a href="#val-generate" class="anchor"></a><code><span><span class="keyword">val</span> generate : <span><a href="../../../spoc/Sarek_ir_types/index.html#type-kernel">Sarek_ir_types.kernel</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Generate complete Metal source for a kernel</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-generate_for_device"><a href="#val-generate_for_device" class="anchor"></a><code><span><span class="keyword">val</span> generate_for_device : 
  <span><span class="label">device</span>:<a href="../../../sarek/Spoc_core/Device/index.html#type-t">Spoc_core.Device.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../spoc/Sarek_ir_types/index.html#type-kernel">Sarek_ir_types.kernel</a> <span class="arrow">&#45;&gt;</span></span>
  string</span></code></div><div class="spec-doc"><p>Generate complete Metal source with device context for SNative</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gen_variant_def"><a href="#val-gen_variant_def" class="anchor"></a><code><span><span class="keyword">val</span> gen_variant_def : 
  <span><span class="xref-unresolved">Stdlib</span>.Buffer.t <span class="arrow">&#45;&gt;</span></span>
  <span><span>(string * <span><span>(string * <span><a href="../../../spoc/Sarek_ir_types/index.html#type-elttype">Sarek_ir_types.elttype</a> list</span>)</span> list</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Generate variant type definition for Metal</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-generate_with_types"><a href="#val-generate_with_types" class="anchor"></a><code><span><span class="keyword">val</span> generate_with_types : 
  <span><span class="label">types</span>:<span><span>(string * <span><span>(string * <a href="../../../spoc/Sarek_ir_types/index.html#type-elttype">Sarek_ir_types.elttype</a>)</span> list</span>)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../spoc/Sarek_ir_types/index.html#type-kernel">Sarek_ir_types.kernel</a> <span class="arrow">&#45;&gt;</span></span>
  string</span></code></div><div class="spec-doc"><p>Generate Metal source with custom type definitions</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-generate_with_fp64"><a href="#val-generate_with_fp64" class="anchor"></a><code><span><span class="keyword">val</span> generate_with_fp64 : <span><a href="../../../spoc/Sarek_ir_types/index.html#type-kernel">Sarek_ir_types.kernel</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Generate Metal source with double precision (Metal supports FP64 natively)</p></div></div></div></body></html>
