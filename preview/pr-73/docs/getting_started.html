<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link rel="icon" href="/Sarek/preview/pr-73/favicon.ico" />
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
    <script src="/Sarek/preview/pr-73/javascripts/process-rel-links.js" type="text/javascript"></script>
    <title>Getting Started with Sarek - Sarek</title>
    
    <link rel="stylesheet" href='/Sarek/preview/pr-73/stylesheets/modern.css'>
    <link rel="stylesheet" href='/Sarek/preview/pr-73/stylesheets/pygment_trac.css'>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  </head>
  <body>

    <!-- Top Navigation Bar -->
    <nav class="navbar">
      <div class="container">
        <a href="/Sarek/preview/pr-73/" class="nav-brand">
          <img src="/Sarek/preview/pr-73/pres_resources/logo_sarek.png" alt="Sarek Logo">
          Sarek
        </a>
        <div class="nav-links">
          <a href="/Sarek/preview/pr-73/">Home</a>
          <a href="/Sarek/preview/pr-73/docs/getting_started.html">Getting Started</a>
          <a href="/Sarek/preview/pr-73/benchmarks/">Benchmarks</a>
          <a href="/Sarek/preview/pr-73/examples/">Examples</a>
          <div class="nav-dropdown">
            <a href="#" class="dropdown-toggle">Docs â–¾</a>
            <div class="dropdown-menu">
              <a href="/Sarek/preview/pr-73/docs/concepts.html">Concepts</a>
              <a href="/Sarek/preview/pr-73/docs/architecture.html">Architecture</a>
              <a href="/Sarek/preview/pr-73/docs/backends.html">Backends</a>
              <a href="/Sarek/preview/pr-73/docs/build_guide.html">Build Guide</a>
              <a href="/Sarek/preview/pr-73/docs/faq.html">FAQ</a>
              <a href="/Sarek/preview/pr-73/docs/publications.html">Publications</a>
            </div>
          </div>
          <a href="/Sarek/preview/pr-73/spoc_docs/index.html">API</a>
          <a href="https://github.com/mathiasbourgoin/Sarek">GitHub</a>
          <button id="theme-toggle" title="Toggle Dark/Light Mode">
            <span>ðŸŒ™</span>
          </button>
        </div>
      </div>
    </nav>

    <main class="main-content">
      <div class="container">
        <h1 id="getting-started-with-sarek">Getting Started with Sarek</h1>

<p>Sarek is a high-performance framework for GPGPU programming in OCaml. It allows you to write kernels directly in OCaml syntax and execute them on various backends including CUDA, OpenCL, Vulkan, and Metal.</p>

<h2 id="installation">Installation</h2>

<h3 id="prerequisites">Prerequisites</h3>

<ul>
  <li><strong>OCaml</strong>: 5.4.0+ (required for effects and domains support)</li>
  <li><strong>Dune</strong>: 3.20+</li>
  <li><strong>GPU Drivers</strong> (optional):
    <ul>
      <li><strong>CUDA</strong>: NVIDIA drivers + CUDA Toolkit</li>
      <li><strong>OpenCL</strong>: OpenCL runtime (Intel NEO, ROCm, etc.)</li>
      <li><strong>Vulkan</strong>: Vulkan SDK + glslangValidator</li>
      <li><strong>Metal</strong>: macOS 10.13+ (included with Xcode)</li>
    </ul>
  </li>
</ul>

<h3 id="installing-via-opam">Installing via Opam</h3>

<p>Sarek is available via Opam. To install the core package and specific backends:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Core packages</span>
opam <span class="nb">install </span>sarek spoc

<span class="c"># Install specific GPU backends (optional)</span>
opam <span class="nb">install </span>sarek-cuda      <span class="c"># For NVIDIA GPUs</span>
opam <span class="nb">install </span>sarek-opencl    <span class="c"># For OpenCL devices</span>
opam <span class="nb">install </span>sarek-vulkan    <span class="c"># For Vulkan support</span>
opam <span class="nb">install </span>sarek-metal     <span class="c"># For Apple Silicon/Macs</span>
</code></pre></div></div>

<h2 id="your-first-kernel-vector-addition">Your First Kernel: Vector Addition</h2>

<p>Here is a complete example of a vector addition kernel. Sarek uses the <code class="language-plaintext highlighter-rouge">[%kernel ...]</code> syntax to define code that runs on the GPU.</p>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">open</span> <span class="nc">Sarek</span>

<span class="c">(* 1. Define the kernel *)</span>
<span class="k">let</span><span class="o">%</span><span class="n">kernel</span> <span class="n">vector_add</span> <span class="p">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">float32</span> <span class="n">vector</span><span class="p">)</span> <span class="p">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">float32</span> <span class="n">vector</span><span class="p">)</span> <span class="p">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">float32</span> <span class="n">vector</span><span class="p">)</span> <span class="o">=</span>
  <span class="c">(* Get the global thread ID *)</span>
  <span class="k">let</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">get_global_id</span> <span class="mi">0</span> <span class="k">in</span>
  
  <span class="c">(* Perform computation if within bounds *)</span>
  <span class="c">(* Note: Arrays use unsafe access syntax inside kernels for performance *)</span>
  <span class="n">c</span><span class="o">.</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">a</span><span class="o">.</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

<span class="k">let</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="c">(* 2. Initialize input data *)</span>
  <span class="k">let</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">1024</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">a</span> <span class="o">=</span> <span class="nn">Vector</span><span class="p">.</span><span class="n">create</span> <span class="nc">Float32</span> <span class="n">n</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">b</span> <span class="o">=</span> <span class="nn">Vector</span><span class="p">.</span><span class="n">create</span> <span class="nc">Float32</span> <span class="n">n</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">c</span> <span class="o">=</span> <span class="nn">Vector</span><span class="p">.</span><span class="n">create</span> <span class="nc">Float32</span> <span class="n">n</span> <span class="k">in</span>
  
  <span class="c">(* Fill vectors with data *)</span>
  <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">to</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">do</span>
    <span class="nn">Vector</span><span class="p">.</span><span class="n">set</span> <span class="n">a</span> <span class="n">i</span> <span class="p">(</span><span class="n">float_of_int</span> <span class="n">i</span><span class="p">);</span>
    <span class="nn">Vector</span><span class="p">.</span><span class="n">set</span> <span class="n">b</span> <span class="n">i</span> <span class="p">(</span><span class="n">float_of_int</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span><span class="p">));</span>
  <span class="k">done</span><span class="p">;</span>

  <span class="c">(* 3. Select a device (auto-detects available GPU) *)</span>
  <span class="k">let</span> <span class="n">device</span> <span class="o">=</span> <span class="nn">Device</span><span class="p">.</span><span class="n">get_default</span> <span class="bp">()</span> <span class="k">in</span>
  <span class="nn">Printf</span><span class="p">.</span><span class="n">printf</span> <span class="s2">"Using device: %s</span><span class="se">\n</span><span class="s2">"</span> <span class="p">(</span><span class="nn">Device</span><span class="p">.</span><span class="n">name</span> <span class="n">device</span><span class="p">);</span>

  <span class="c">(* 4. Execute the kernel *)</span>
  <span class="c">(* Grid: 4 blocks, Block: 256 threads -&gt; 1024 total threads *)</span>
  <span class="nn">Execute</span><span class="p">.</span><span class="n">run</span> <span class="n">vector_add</span> 
    <span class="o">~</span><span class="n">device</span> 
    <span class="o">~</span><span class="n">grid</span><span class="o">:</span><span class="p">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="p">)</span> 
    <span class="o">~</span><span class="n">block</span><span class="o">:</span><span class="p">(</span><span class="mi">256</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="p">)</span> 
    <span class="p">[</span><span class="nc">Vec</span> <span class="n">a</span><span class="p">;</span> <span class="nc">Vec</span> <span class="n">b</span><span class="p">;</span> <span class="nc">Vec</span> <span class="n">c</span><span class="p">];</span>

  <span class="c">(* 5. Check results *)</span>
  <span class="k">let</span> <span class="n">result</span> <span class="o">=</span> <span class="nn">Vector</span><span class="p">.</span><span class="n">get</span> <span class="n">c</span> <span class="mi">10</span> <span class="k">in</span>
  <span class="nn">Printf</span><span class="p">.</span><span class="n">printf</span> <span class="s2">"c[10] = %f</span><span class="se">\n</span><span class="s2">"</span> <span class="n">result</span>
</code></pre></div></div>

<h2 id="shared-memory--synchronization">Shared Memory &amp; Synchronization</h2>

<p>Sarek supports advanced GPU features like shared memory and barriers. Here is an example of a parallel reduction (summing a vector).</p>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span><span class="o">%</span><span class="n">kernel</span> <span class="n">reduce_sum</span> <span class="p">(</span><span class="n">input</span> <span class="o">:</span> <span class="n">float32</span> <span class="n">vector</span><span class="p">)</span> <span class="p">(</span><span class="n">output</span> <span class="o">:</span> <span class="n">float32</span> <span class="n">vector</span><span class="p">)</span> <span class="p">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">int32</span><span class="p">)</span> <span class="o">=</span>
  <span class="c">(* Allocate shared memory for the thread block *)</span>
  <span class="k">let</span><span class="o">%</span><span class="n">shared</span> <span class="n">sdata</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">create</span> <span class="nc">Float32</span> <span class="mi">256</span> <span class="k">in</span>
  
  <span class="k">let</span> <span class="n">tid</span> <span class="o">=</span> <span class="n">thread_idx_x</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">gid</span> <span class="o">=</span> <span class="n">get_global_id</span> <span class="mi">0</span> <span class="k">in</span>
  
  <span class="c">(* Load data into shared memory *)</span>
  <span class="n">sdata</span><span class="o">.</span><span class="p">(</span><span class="n">tid</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="k">if</span> <span class="n">gid</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="k">then</span> <span class="n">input</span><span class="o">.</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="p">;</span>
  
  <span class="c">(* Synchronize all threads in the block *)</span>
  <span class="n">barrier</span> <span class="bp">()</span><span class="p">;</span>

  <span class="c">(* Tree reduction in shared memory *)</span>
  <span class="k">let</span> <span class="n">stride</span> <span class="o">=</span> <span class="n">ref</span> <span class="mi">128</span> <span class="k">in</span>
  <span class="k">while</span> <span class="o">!</span><span class="n">stride</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">do</span>
    <span class="k">if</span> <span class="n">tid</span> <span class="o">&lt;</span> <span class="o">!</span><span class="n">stride</span> <span class="k">then</span>
      <span class="n">sdata</span><span class="o">.</span><span class="p">(</span><span class="n">tid</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">sdata</span><span class="o">.</span><span class="p">(</span><span class="n">tid</span><span class="p">)</span> <span class="o">+.</span> <span class="n">sdata</span><span class="o">.</span><span class="p">(</span><span class="n">tid</span> <span class="o">+</span> <span class="o">!</span><span class="n">stride</span><span class="p">);</span>
    <span class="n">barrier</span> <span class="bp">()</span><span class="p">;</span>
    <span class="n">stride</span> <span class="o">:=</span> <span class="o">!</span><span class="n">stride</span> <span class="o">/</span> <span class="mi">2</span>
  <span class="k">done</span><span class="p">;</span>

  <span class="c">(* Write the block result to global memory *)</span>
  <span class="k">if</span> <span class="n">tid</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">then</span>
    <span class="n">output</span><span class="o">.</span><span class="p">(</span><span class="n">block_idx_x</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">sdata</span><span class="o">.</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="compilation">Compilation</h2>

<p>Build your project with <code class="language-plaintext highlighter-rouge">dune</code>:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nv">executable</span>
 <span class="p">(</span><span class="nv">name</span> <span class="nv">my_program</span><span class="p">)</span>
 <span class="p">(</span><span class="nv">libraries</span> <span class="nv">sarek</span> <span class="nv">spoc</span><span class="p">)</span>
 <span class="p">(</span><span class="nv">preprocess</span> <span class="p">(</span><span class="nv">pps</span> <span class="nv">sarek.ppx</span><span class="p">)))</span>
</code></pre></div></div>

<p>Run it:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dune <span class="nb">exec</span> ./my_program.exe
</code></pre></div></div>

<h2 id="next-steps">Next Steps</h2>

<ul>
  <li><strong><a href="../examples/">Examples</a></strong> - Learn through practical examples (vector add, matrix multiply, reduction, transpose, mandelbrot)</li>
  <li><strong><a href="concepts.html">Concepts</a></strong> - Understand Sarekâ€™s design and programming model</li>
  <li><strong><a href="../benchmarks/">Benchmarks</a></strong> - See performance data across different GPUs and backends</li>
  <li><strong><a href="backends.html">Backends</a></strong> - Learn about CUDA, OpenCL, Vulkan, and Metal support</li>
  <li><strong><a href="../spoc_docs/index.html">API Documentation</a></strong> - Complete API reference</li>
</ul>

      </div>
    </main>

    <footer>
      <div class="container">
        <p>Sarek is maintained by <a href="https://github.com/mathiasbourgoin">mathiasbourgoin</a></p>
        <p>Hosted on GitHub Pages</p>
      </div>
    </footer>

    <script src="/Sarek/preview/pr-73/javascripts/scale.fix.js"></script>
    <script src="/Sarek/preview/pr-73/javascripts/copy-code.js"></script>
    <script src="/Sarek/preview/pr-73/javascripts/theme-toggle.js"></script>
    <script src="/Sarek/preview/pr-73/javascripts/syntax-sarek.js"></script>
  </body>
</html>
