<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Sarek_registry (spoc.Sarek_registry)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">Index</a> &#x00BB; <a href="../index.html">spoc</a> &#x00BB; Sarek_registry</nav><header class="odoc-preamble"><h1>Module <code><span>Sarek_registry</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-type_info"><a href="#type-type_info" class="anchor"></a><code><span><span class="keyword">type</span> type_info</span><span> = </span><span>{</span></code><ol><li id="type-type_info.ti_name" class="def record field anchored"><a href="#type-type_info.ti_name" class="anchor"></a><code><span>ti_name : string;</span></code></li><li id="type-type_info.ti_device" class="def record field anchored"><a href="#type-type_info.ti_device" class="anchor"></a><code><span>ti_device : <span><a href="../Spoc_framework/Device_type/index.html#type-t">Spoc_framework.Device_type.t</a> <span class="arrow">&#45;&gt;</span></span> string;</span></code></li><li id="type-type_info.ti_size" class="def record field anchored"><a href="#type-type_info.ti_size" class="anchor"></a><code><span>ti_size : int;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Information about a primitive/intrinsic type (float32, int64, etc.)</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-field_info"><a href="#type-field_info" class="anchor"></a><code><span><span class="keyword">type</span> field_info</span><span> = </span><span>{</span></code><ol><li id="type-field_info.field_name" class="def record field anchored"><a href="#type-field_info.field_name" class="anchor"></a><code><span>field_name : string;</span></code></li><li id="type-field_info.field_type" class="def record field anchored"><a href="#type-field_info.field_type" class="anchor"></a><code><span>field_type : string;</span></code></li><li id="type-field_info.field_mutable" class="def record field anchored"><a href="#type-field_info.field_mutable" class="anchor"></a><code><span>field_mutable : bool;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Information about a record field</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-record_info"><a href="#type-record_info" class="anchor"></a><code><span><span class="keyword">type</span> record_info</span><span> = </span><span>{</span></code><ol><li id="type-record_info.ri_name" class="def record field anchored"><a href="#type-record_info.ri_name" class="anchor"></a><code><span>ri_name : string;</span></code></li><li id="type-record_info.ri_fields" class="def record field anchored"><a href="#type-record_info.ri_fields" class="anchor"></a><code><span>ri_fields : <span><a href="#type-field_info">field_info</a> list</span>;</span></code></li><li id="type-record_info.ri_size" class="def record field anchored"><a href="#type-record_info.ri_size" class="anchor"></a><code><span>ri_size : int;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Information about a record type (user-defined via <code>@@sarek.type</code>)</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-constructor_info"><a href="#type-constructor_info" class="anchor"></a><code><span><span class="keyword">type</span> constructor_info</span><span> = </span><span>{</span></code><ol><li id="type-constructor_info.ctor_name" class="def record field anchored"><a href="#type-constructor_info.ctor_name" class="anchor"></a><code><span>ctor_name : string;</span></code></li><li id="type-constructor_info.ctor_arg_type" class="def record field anchored"><a href="#type-constructor_info.ctor_arg_type" class="anchor"></a><code><span>ctor_arg_type : <span>string option</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Information about a variant constructor</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-variant_info"><a href="#type-variant_info" class="anchor"></a><code><span><span class="keyword">type</span> variant_info</span><span> = </span><span>{</span></code><ol><li id="type-variant_info.vi_name" class="def record field anchored"><a href="#type-variant_info.vi_name" class="anchor"></a><code><span>vi_name : string;</span></code></li><li id="type-variant_info.vi_constructors" class="def record field anchored"><a href="#type-variant_info.vi_constructors" class="anchor"></a><code><span>vi_constructors : <span><a href="#type-constructor_info">constructor_info</a> list</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Information about a variant type</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-fun_info"><a href="#type-fun_info" class="anchor"></a><code><span><span class="keyword">type</span> fun_info</span><span> = </span><span>{</span></code><ol><li id="type-fun_info.fi_name" class="def record field anchored"><a href="#type-fun_info.fi_name" class="anchor"></a><code><span>fi_name : string;</span></code></li><li id="type-fun_info.fi_arity" class="def record field anchored"><a href="#type-fun_info.fi_arity" class="anchor"></a><code><span>fi_arity : int;</span></code></li><li id="type-fun_info.fi_device" class="def record field anchored"><a href="#type-fun_info.fi_device" class="anchor"></a><code><span>fi_device : <span><a href="../Spoc_framework/Device_type/index.html#type-t">Spoc_framework.Device_type.t</a> <span class="arrow">&#45;&gt;</span></span> string;</span></code></li><li id="type-fun_info.fi_arg_types" class="def record field anchored"><a href="#type-fun_info.fi_arg_types" class="anchor"></a><code><span>fi_arg_types : <span>string list</span>;</span></code></li><li id="type-fun_info.fi_ret_type" class="def record field anchored"><a href="#type-fun_info.fi_ret_type" class="anchor"></a><code><span>fi_ret_type : string;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Information about an intrinsic function</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-type_registry"><a href="#val-type_registry" class="anchor"></a><code><span><span class="keyword">val</span> type_registry : <span><span>(string, <a href="#type-type_info">type_info</a>)</span> <span class="xref-unresolved">Stdlib</span>.Hashtbl.t</span></span></code></div><div class="spec-doc"><p>Type registry - maps type names to their info (primitives)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-record_registry"><a href="#val-record_registry" class="anchor"></a><code><span><span class="keyword">val</span> record_registry : <span><span>(string, <a href="#type-record_info">record_info</a>)</span> <span class="xref-unresolved">Stdlib</span>.Hashtbl.t</span></span></code></div><div class="spec-doc"><p>Record registry - maps type names to their info (user-defined records)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-variant_registry"><a href="#val-variant_registry" class="anchor"></a><code><span><span class="keyword">val</span> variant_registry : <span><span>(string, <a href="#type-variant_info">variant_info</a>)</span> <span class="xref-unresolved">Stdlib</span>.Hashtbl.t</span></span></code></div><div class="spec-doc"><p>Variant registry - maps type names to their info (user-defined variants)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fun_registry"><a href="#val-fun_registry" class="anchor"></a><code><span><span class="keyword">val</span> fun_registry : <span><span>(<span>string list</span> * string, <a href="#type-fun_info">fun_info</a>)</span> <span class="xref-unresolved">Stdlib</span>.Hashtbl.t</span></span></code></div><div class="spec-doc"><p>Function registry - maps (module_path, name) to their info</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-register_type"><a href="#val-register_type" class="anchor"></a><code><span><span class="keyword">val</span> register_type : 
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">device</span>:<span>(<span><a href="../Spoc_framework/Device_type/index.html#type-t">Spoc_framework.Device_type.t</a> <span class="arrow">&#45;&gt;</span></span> string)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">size</span>:int <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Register a primitive type</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-register_record"><a href="#val-register_record" class="anchor"></a><code><span><span class="keyword">val</span> register_record : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="label">fields</span>:<span><a href="#type-field_info">field_info</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">size</span>:int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Register a record type (called by PPX-generated code for <code>@@sarek.type</code>)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-register_variant"><a href="#val-register_variant" class="anchor"></a><code><span><span class="keyword">val</span> register_variant : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="label">constructors</span>:<span><a href="#type-constructor_info">constructor_info</a> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Register a variant type (called by PPX-generated code for <code>@@sarek.type</code>)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-register_fun"><a href="#val-register_fun" class="anchor"></a><code><span><span class="keyword">val</span> register_fun : 
  <span><span class="optlabel">?module_path</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">arity</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">device</span>:<span>(<span><a href="../Spoc_framework/Device_type/index.html#type-t">Spoc_framework.Device_type.t</a> <span class="arrow">&#45;&gt;</span></span> string)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">arg_types</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">ret_type</span>:string <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Register an intrinsic function</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_type"><a href="#val-find_type" class="anchor"></a><code><span><span class="keyword">val</span> find_type : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-type_info">type_info</a> option</span></span></code></div><div class="spec-doc"><p>Find a primitive type by name</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_record"><a href="#val-find_record" class="anchor"></a><code><span><span class="keyword">val</span> find_record : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-record_info">record_info</a> option</span></span></code></div><div class="spec-doc"><p>Find a record type by name</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_variant"><a href="#val-find_variant" class="anchor"></a><code><span><span class="keyword">val</span> find_variant : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-variant_info">variant_info</a> option</span></span></code></div><div class="spec-doc"><p>Find a variant type by name</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_fun"><a href="#val-find_fun" class="anchor"></a><code><span><span class="keyword">val</span> find_fun : <span><span class="optlabel">?module_path</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-fun_info">fun_info</a> option</span></span></code></div><div class="spec-doc"><p>Find a function by name, optionally in a module</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_type"><a href="#val-is_type" class="anchor"></a><code><span><span class="keyword">val</span> is_type : <span>string <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Check if a name is a registered primitive type</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_record"><a href="#val-is_record" class="anchor"></a><code><span><span class="keyword">val</span> is_record : <span>string <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Check if a name is a registered record type</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_variant"><a href="#val-is_variant" class="anchor"></a><code><span><span class="keyword">val</span> is_variant : <span>string <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Check if a name is a registered variant type</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_fun"><a href="#val-is_fun" class="anchor"></a><code><span><span class="keyword">val</span> is_fun : <span><span class="optlabel">?module_path</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Check if a name is a registered function</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-type_device_code"><a href="#val-type_device_code" class="anchor"></a><code><span><span class="keyword">val</span> type_device_code : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="../Spoc_framework/Device_type/index.html#type-t">Spoc_framework.Device_type.t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get device code for a type</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fun_device_code"><a href="#val-fun_device_code" class="anchor"></a><code><span><span class="keyword">val</span> fun_device_code : 
  <span><span class="optlabel">?module_path</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Spoc_framework/Device_type/index.html#type-t">Spoc_framework.Device_type.t</a> <span class="arrow">&#45;&gt;</span></span>
  string</span></code></div><div class="spec-doc"><p>Get device code for a function</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fun_device_template"><a href="#val-fun_device_template" class="anchor"></a><code><span><span class="keyword">val</span> fun_device_template : <span><span class="optlabel">?module_path</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span>string option</span></span></code></div><div class="spec-doc"><p>Get device code template for a function, using a minimal device. This is for V2 IR codegens that don't have SPOC device objects.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_record_by_short_name"><a href="#val-find_record_by_short_name" class="anchor"></a><code><span><span class="keyword">val</span> find_record_by_short_name : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-record_info">record_info</a> option</span></span></code></div><div class="spec-doc"><p>Find a record by short name (last component after '.'). This handles cases where the registry uses qualified names like &quot;Module.typename&quot; but the custom_type uses just &quot;typename&quot;.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-record_fields"><a href="#val-record_fields" class="anchor"></a><code><span><span class="keyword">val</span> record_fields : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-field_info">field_info</a> list</span></span></code></div><div class="spec-doc"><p>Get record field info - tries exact match first, then short name</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-variant_constructors"><a href="#val-variant_constructors" class="anchor"></a><code><span><span class="keyword">val</span> variant_constructors : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-constructor_info">constructor_info</a> list</span></span></code></div><div class="spec-doc"><p>Get variant constructors</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-cuda_or_opencl"><a href="#val-cuda_or_opencl" class="anchor"></a><code><span><span class="keyword">val</span> cuda_or_opencl : <span><a href="../Spoc_framework/Device_type/index.html#type-t">Spoc_framework.Device_type.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div></div></div></body></html>
