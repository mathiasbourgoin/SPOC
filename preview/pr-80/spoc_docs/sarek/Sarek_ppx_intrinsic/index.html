<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Sarek_ppx_intrinsic (sarek.Sarek_ppx_intrinsic)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">Index</a> &#x00BB; <a href="../index.html">sarek</a> &#x00BB; Sarek_ppx_intrinsic</nav><header class="odoc-preamble"><h1>Module <code><span>Sarek_ppx_intrinsic</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-parsed_type"><a href="#type-parsed_type" class="anchor"></a><code><span><span class="keyword">type</span> parsed_type</span><span> = </span></code><ol><li id="type-parsed_type.PTSimple" class="def variant constructor anchored"><a href="#type-parsed_type.PTSimple" class="anchor"></a><code><span>| </span><span><span class="constructor">PTSimple</span> <span class="keyword">of</span> string</span></code></li><li id="type-parsed_type.PTArray" class="def variant constructor anchored"><a href="#type-parsed_type.PTArray" class="anchor"></a><code><span>| </span><span><span class="constructor">PTArray</span> <span class="keyword">of</span> <a href="#type-parsed_type">parsed_type</a></span></code></li><li id="type-parsed_type.PTVec" class="def variant constructor anchored"><a href="#type-parsed_type.PTVec" class="anchor"></a><code><span>| </span><span><span class="constructor">PTVec</span> <span class="keyword">of</span> <a href="#type-parsed_type">parsed_type</a></span></code></li><li id="type-parsed_type.PTArrow" class="def variant constructor anchored"><a href="#type-parsed_type.PTArrow" class="anchor"></a><code><span>| </span><span><span class="constructor">PTArrow</span> <span class="keyword">of</span> <a href="#type-parsed_type">parsed_type</a> * <a href="#type-parsed_type">parsed_type</a></span></code></li></ol></div><div class="spec-doc"><p>Parsed type representation for intrinsic declarations</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-parsed_type_of_core_type"><a href="#val-parsed_type_of_core_type" class="anchor"></a><code><span><span class="keyword">val</span> parsed_type_of_core_type : <span><span class="xref-unresolved">Ppxlib</span>.core_type <span class="arrow">&#45;&gt;</span></span> <a href="#type-parsed_type">parsed_type</a></span></code></div><div class="spec-doc"><p>Extract parsed type from a core_type</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-type_name_of_core_type"><a href="#val-type_name_of_core_type" class="anchor"></a><code><span><span class="keyword">val</span> type_name_of_core_type : <span><span class="xref-unresolved">Ppxlib</span>.core_type <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Extract type name from a core_type for registry registration (string representation)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-module_path_of_loc"><a href="#val-module_path_of_loc" class="anchor"></a><code><span><span class="keyword">val</span> module_path_of_loc : <span><span class="xref-unresolved">Ppxlib</span>.location <span class="arrow">&#45;&gt;</span></span> <span>string list</span></span></code></div><div class="spec-doc"><p>Get the full module path from a location. For wrapped libraries like Sarek_stdlib, modules are accessed as Sarek_stdlib.Float32, so we need <code>Sarek_stdlib; Float32</code> as the path. This is derived from the directory structure.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sarek_type_of_simple_name"><a href="#val-sarek_type_of_simple_name" class="anchor"></a><code><span><span class="keyword">val</span> sarek_type_of_simple_name : 
  <span><span class="label">loc</span>:<span class="xref-unresolved">Ppxlib</span>.location <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppxlib</span>.expression</span></code></div><div class="spec-doc"><p>Convert simple type name to Sarek_types representation</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-flatten_arrow"><a href="#val-flatten_arrow" class="anchor"></a><code><span><span class="keyword">val</span> flatten_arrow : <span><a href="#type-parsed_type">parsed_type</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-parsed_type">parsed_type</a> list</span> * <a href="#type-parsed_type">parsed_type</a></span></code></div><div class="spec-doc"><p>Flatten a parsed arrow type into (arg_types, return_type). E.g., PTArrow(a, PTArrow(b, c)) becomes (<code>a; b</code>, c)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sarek_type_of_simple_parsed"><a href="#val-sarek_type_of_simple_parsed" class="anchor"></a><code><span><span class="keyword">val</span> sarek_type_of_simple_parsed : 
  <span><span class="label">loc</span>:<span class="xref-unresolved">Ppxlib</span>.location <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-parsed_type">parsed_type</a> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppxlib</span>.expression</span></code></div><div class="spec-doc"><p>Convert a non-arrow parsed type to Sarek_types representation</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sarek_type_of_parsed"><a href="#val-sarek_type_of_parsed" class="anchor"></a><code><span><span class="keyword">val</span> sarek_type_of_parsed : 
  <span><span class="label">loc</span>:<span class="xref-unresolved">Ppxlib__</span>.Location.t <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-parsed_type">parsed_type</a> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppxlib</span>.expression</span></code></div><div class="spec-doc"><p>Convert parsed type to Sarek_types representation. Flattens arrow types so a -&gt; b -&gt; c becomes TFun(<code>a; b</code>, c).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sarek_type_of_name"><a href="#val-sarek_type_of_name" class="anchor"></a><code><span><span class="keyword">val</span> sarek_type_of_name : <span><span class="label">loc</span>:<span class="xref-unresolved">Ppxlib</span>.location <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Ppxlib</span>.expression</span></code></div><div class="spec-doc"><p>Convert type name string to Sarek_types representation (for backward compat)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-build_sarek_fun_type"><a href="#val-build_sarek_fun_type" class="anchor"></a><code><span><span class="keyword">val</span> build_sarek_fun_type : 
  <span><span class="label">loc</span>:<span class="xref-unresolved">Ppxlib</span>.location <span class="arrow">&#45;&gt;</span></span>
  <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppxlib</span>.expression</span></code></div><div class="spec-doc"><p>Build a function type from argument types and return type</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-expand_sarek_intrinsic_type"><a href="#val-expand_sarek_intrinsic_type" class="anchor"></a><code><span><span class="keyword">val</span> expand_sarek_intrinsic_type : 
  <span><span class="label">ctxt</span>:<span class="xref-unresolved">Ppxlib</span>.Expansion_context.Extension.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Ppxlib</span>.payload <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Ppxlib_ast</span>.Ast.structure_item list</span></span></code></div><div class="spec-doc"><p>Extension for type%sarek_intrinsic - handles type registration</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-extract_fun_types"><a href="#val-extract_fun_types" class="anchor"></a><code><span><span class="keyword">val</span> extract_fun_types : <span><span class="xref-unresolved">Ppxlib</span>.core_type <span class="arrow">&#45;&gt;</span></span> <span>string list</span> * string</span></code></div><div class="spec-doc"><p>Extract argument types and return type from a function type</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-expand_sarek_intrinsic_fun"><a href="#val-expand_sarek_intrinsic_fun" class="anchor"></a><code><span><span class="keyword">val</span> expand_sarek_intrinsic_fun : 
  <span><span class="label">ctxt</span>:<span class="xref-unresolved">Ppxlib</span>.Expansion_context.Extension.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Ppxlib</span>.payload <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Ppxlib_ast</span>.Ast.structure_item list</span></span></code></div><div class="spec-doc"><p>Extension for let%sarek_intrinsic - handles function registration</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-expand_sarek_intrinsic"><a href="#val-expand_sarek_intrinsic" class="anchor"></a><code><span><span class="keyword">val</span> expand_sarek_intrinsic : 
  <span><span class="label">ctxt</span>:<span class="xref-unresolved">Ppxlib</span>.Expansion_context.Extension.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Ppxlib</span>.payload <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Ppxlib_ast</span>.Ast.structure_item list</span></span></code></div><div class="spec-doc"><p>Combined extension for %sarek_intrinsic - handles both types and functions</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sarek_intrinsic_extension"><a href="#val-sarek_intrinsic_extension" class="anchor"></a><code><span><span class="keyword">val</span> sarek_intrinsic_extension : <span class="xref-unresolved">Ppxlib</span>.Extension.V3.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-expand_sarek_extend"><a href="#val-expand_sarek_extend" class="anchor"></a><code><span><span class="keyword">val</span> expand_sarek_extend : 
  <span><span class="label">ctxt</span>:<span class="xref-unresolved">Ppxlib</span>.Expansion_context.Extension.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Ppxlib</span>.payload <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppxlib_ast</span>.Ast.structure_item</span></code></div><div class="spec-doc"><p>Extension for %sarek_extend - allows extending intrinsics for new backends.</p><p>Syntax: let%sarek_extend Module.func = fun dev -&gt; if ... then &quot;new_code&quot; else Module.func_device dev</p><p>This updates the Module.func_device_ref to point to the new function, which chains to the original via Module.func_device.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sarek_extend_extension"><a href="#val-sarek_extend_extension" class="anchor"></a><code><span><span class="keyword">val</span> sarek_extend_extension : <span class="xref-unresolved">Ppxlib</span>.Extension.V3.t</span></code></div></div></div></body></html>
